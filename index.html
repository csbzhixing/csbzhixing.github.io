<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/uploads/avatar.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">之行</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/uploads/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">之行</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-再看2017" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/05/再看2017/">再看2017</a>
    </h1>
  

        
        <a href="/2018/01/05/再看2017/" class="archive-article-date">
  	<time datetime="2018-01-05T07:31:26.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-01-05</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2017"><a href="#2017" class="headerlink" title="2017"></a>2017</h1><p>走出学校的第一年就在忙碌的工作中度过了。看了很多大佬总结了自己的2017，作为职场萌新也该好好总结下，自己的2017了。</p>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>从实习转变到正式工作，再从一家换到另一家。一年的转变似乎并没有给自己留下很深的烙印。一切在自己看来似乎是顺利成章。</p>
<p>步入工作，再没有老师家长会告诉你，什么你该做什么你要做。无限的自由也带来了无限的无助。好在自己在和不少很棒的小伙伴聊过后，也决定了自己的方向。</p>
<p>转换工作的初始目的，是为了能够有更多的锻炼，以及一点待遇上的提升。到目前为止，两者似乎又在怂恿我继续寻找下一个目标了。</p>
<p>在一个初级开发迈向中级开发的，2017给我最大的迷茫是，没有很好的目标以及一个好的导师。前一个项目在内部斗争和大老板举棋不定的变成了牺牲品，在一降再降的KPI中混过了一个2017.现在的项目虽然经历五年的风风雨雨，但是依然存在着许多我看来不应该存在的问题。一个新，一个老，似乎最后的归宿都是一样的。在项目中，太难太难能碰到有价值的问题，更多是如何完成上线如何压榨时间。而在两个团队，都没有碰到一个能够hold一切的大神。许多问题，都是自己在思考许久后闭门造车出来的方案，好还是不好也无从评价。</p>
<p>工作不应该只为了生活的苟且，更应该去追寻梦想。</p>
<p>有了一个小小的打算，2018，去迎接新的挑战。</p>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><p>2017依然在iOS开发的道路上狂奔。学了一点swift，但是没有成熟的项目时间。继续深化了react开发，试图在现在的项目中能够应用。学了一点node开发，了解了后端应用开发的基本知识。</p>
<p>学习swift和react开发，让自己打开了自己的思想。在之前，一个OOP似乎就是一切，甚至对OOP的思想也不甚了解。编程思想的创新不在于是耍酷，而是让自己在面对不同的问题的时候，能够去寻找最优解。</p>
<p>iOS开发进入了第三个年头，研究的方向开始走整个项目架构的设计了。如今的项目运行了五年，但在开始的时候并没有一个良好的架构设计。在来来往往不知道多少开发经手过后，变成了一个前有坑后有墙的项目。iOS开发不比其他web服务或后端应用，出现大型的应用也就是最近两三年。多数开发并没有或半路出家或碌碌无为，并没有考虑架构设计在iOS应用的落地。而自己，也希望能够在现在的项目上，投入时间和精力，打造一个合适的架构。</p>
<h2 id="读书"><a href="#读书" class="headerlink" title="读书"></a>读书</h2><p>2017年，投入了不少时间读书和读文章。kindle是一个好东西，每天中午和通勤路上都能让自己看和学不少东西。</p>
<p>读书的内容很杂，有小说，有金融，有技术。而文章多偏向技术方面。</p>
<p>大学的时候，很喜欢刷知乎和微博，觉得里面似乎有无穷无尽新奇的东西。但是工作后，发现，知乎和微博，只能拿来消遣。提升自己，只能取看书和深度的文章。读书和读文，更重要的是思考。好与坏，对与错，作者的论点和观点如何，一切都是自己取决于自己的思考。</p>
<h2 id="旅行"><a href="#旅行" class="headerlink" title="旅行"></a>旅行</h2><p>2017去了两个地方：三亚和澳门。</p>
<p>不同多数人，我更喜欢去泡酒店，以及逛逛这座城市。三亚和澳门刚好满足了我两个爱好。</p>
<p>三亚是一个纯粹的旅游城市，非常适合跑酒店。而三亚酒店带给我的体验也是非常好的。旅游不应该是在马不停蹄走马观花中路过一个又一个景点，而是应该让自己的身心从劳烦的茶米油盐中解放出来。泡酒店，能够让自己不再去思考工作中那些劳烦的事情，随意打发的时间，不失为人生的一大享受。</p>
<p>澳门，我认为是不同于三亚的。作为前殖民地已经东西文化混杂的一个城市，在城区中瞎逛又有一番独特的乐趣。澳门在我眼里，看到的不是赌场，而是文化的交织，富贵与贫穷的交叉。或许，下次再去是N年之后，但是不失为一个有趣的地方。</p>
<h2 id="健身和娱乐"><a href="#健身和娱乐" class="headerlink" title="健身和娱乐"></a>健身和娱乐</h2><p>2017年在家里购置了划船机和哑铃凳，不再出去跑步了。</p>
<p>健身和读书是贯穿人生最有价值的两件事情。</p>
<p>深圳的空气也不再和以往一样，经常灰蒙蒙的一片。看卡pm2.5，往往也是轻度污染状态。</p>
<p>周边的健身房已经突破6K半年了，想想不如购入一套简单的设备，维持基本的有氧和肌肉训练已经坐骨了。</p>
<p>steam的游戏突破了50，还有几个烂橘子的游戏。发现自己已经进入了买了不玩的状态，似乎是在弥补自己之前没钱买游戏的遗憾。2018应该节制一点了。好游戏如同一个艺术品，买了再家里不看不如不买。</p>
<h2 id="钱"><a href="#钱" class="headerlink" title="钱"></a>钱</h2><p>最后个标题，给了钱。</p>
<p>2017感受到了有钱的好和没钱的坏。</p>
<p>感受到有钱的好，比起小时候没有经济支配权，现在的工资可以自己支配，买了许多自己之前不敢买的东西（自然有很多是浪费的）。</p>
<p>感受到没钱的坏，恐怕就是在澳门赌场被有钱人支配的恐惧和深圳动辄数百万的房子了吧。</p>
<p>年底的时候被问了一个问题，什么叫财务自由。</p>
<p>『当你不再问这个问题的时候』</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/01/05/再看2017/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Disk---轻量级 swift 磁盘存储方案实现" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/14/Disk---轻量级 swift 磁盘存储方案实现/">Disk---轻量级 swift 磁盘存储方案实现</a>
    </h1>
  

        
        <a href="/2017/12/14/Disk---轻量级 swift 磁盘存储方案实现/" class="archive-article-date">
  	<time datetime="2017-12-14T07:32:33.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-12-14</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>日常开发，都会有一些简单的归档需求。在 iOS 上，常用的归档主要是<code>userdefault</code>和<code>write to file</code>两种。至于数据库，对于一些轻量级的需求来说未免牛刀杀鸡。在 swift 上，有一个开源库<code>Disk</code>用最少的代码对归档需求进行了封装整理。</p>
<h2 id="支持类型"><a href="#支持类型" class="headerlink" title="支持类型"></a>支持类型</h2><h3 id="data"><a href="#data" class="headerlink" title="data"></a>data</h3><p>disk 支持<code>data</code>,<code>image</code>,<code>codable-data</code>类星体。</p>
<p>data是常用的二进制类型。通常可以为 Image，class object, text 等等</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Save Data to disk</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - value: Data to store to disk</span></span><br><span class="line">    <span class="comment">///   - directory: user directory to store the file in</span></span><br><span class="line">    <span class="comment">///   - path: file location to store the data (i.e. "Folder/file.mp4")</span></span><br><span class="line">    <span class="comment">/// - Throws: Error if there were any issues writing the given data to disk</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">(<span class="number">_</span> value: Data, to directory: Directory, <span class="keyword">as</span> path: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="keyword">try</span> createURL(<span class="keyword">for</span>: path, <span class="keyword">in</span>: directory)</span><br><span class="line">            <span class="keyword">try</span> createSubfoldersBeforeCreatingFile(at: url)</span><br><span class="line">            <span class="keyword">try</span> value.write(to: url, options: .atomic)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Retrieve data from disk</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - path: path where data file is stored</span></span><br><span class="line">    <span class="comment">///   - directory: user directory to retrieve the file from</span></span><br><span class="line">    <span class="comment">///   - type: here for Swifty generics magic, use Data.self</span></span><br><span class="line">    <span class="comment">/// - Returns: Data retrieved from disk</span></span><br><span class="line">    <span class="comment">/// - Throws: Error if there were any issues retrieving the specified file's data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">retrieve</span><span class="params">(<span class="number">_</span> path: String, from directory: Directory, <span class="keyword">as</span> type: Data.<span class="keyword">Type</span>)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="keyword">try</span> getExistingFileURL(<span class="keyword">for</span>: path, <span class="keyword">in</span>: directory)</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">Data</span>(contentsOf: url)</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>image 存储是最常见的需求之一。disk 对 image 的存储实现也很简单</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">(<span class="number">_</span> value: UIImage, to directory: Directory, <span class="keyword">as</span> path: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> imageData: <span class="type">Data</span></span><br><span class="line">            <span class="keyword">if</span> path.suffix(<span class="number">4</span>).lowercased() == <span class="string">".png"</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="type">UIImagePNGRepresentation</span>(value) &#123;</span><br><span class="line">                    imageData = data</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> createError(</span><br><span class="line">                        .serialization,</span><br><span class="line">                        description: <span class="string">"Could not serialize UIImage to PNG."</span>,</span><br><span class="line">                        failureReason: <span class="string">"Data conversion failed."</span>,</span><br><span class="line">                        recoverySuggestion: <span class="string">"Try saving this image as a .jpg or without an extension at all."</span></span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> path.suffix(<span class="number">4</span>).lowercased() == <span class="string">".jpg"</span> || path.suffix(<span class="number">5</span>).lowercased() == <span class="string">".jpeg"</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="type">UIImageJPEGRepresentation</span>(value, <span class="number">1</span>) &#123;</span><br><span class="line">                    imageData = data</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> createError(</span><br><span class="line">                        .serialization,</span><br><span class="line">                        description: <span class="string">"Could not serialize UIImage to JPEG."</span>,</span><br><span class="line">                        failureReason: <span class="string">"Data conversion failed."</span>,</span><br><span class="line">                        recoverySuggestion: <span class="string">"Try saving this image as a .png or without an extension at all."</span></span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="type">UIImagePNGRepresentation</span>(value) &#123;</span><br><span class="line">                    imageData = data</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="type">UIImageJPEGRepresentation</span>(value, <span class="number">1</span>) &#123;</span><br><span class="line">                    imageData = data</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> createError(</span><br><span class="line">                        .serialization,</span><br><span class="line">                        description: <span class="string">"Could not serialize UIImage to Data."</span>,</span><br><span class="line">                        failureReason: <span class="string">"UIImage could not serialize to PNG or JPEG data."</span>,</span><br><span class="line">                        recoverySuggestion: <span class="string">"Make sure image is not corrupt or try saving without an extension at all."</span></span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="keyword">try</span> createURL(<span class="keyword">for</span>: path, <span class="keyword">in</span>: directory)</span><br><span class="line">            <span class="keyword">try</span> createSubfoldersBeforeCreatingFile(at: url)</span><br><span class="line">            <span class="keyword">try</span> imageData.write(to: url, options: .atomic)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">retrieve</span><span class="params">(<span class="number">_</span> path: String, from directory: Directory, <span class="keyword">as</span> type: UIImage.<span class="keyword">Type</span>)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">UIImage</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="keyword">try</span> getExistingFileURL(<span class="keyword">for</span>: path, <span class="keyword">in</span>: directory)</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">Data</span>(contentsOf: url)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">UIImage</span>(data: data) &#123;</span><br><span class="line">                <span class="keyword">return</span> image</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> createError(</span><br><span class="line">                    .deserialization,</span><br><span class="line">                    description: <span class="string">"Could not decode UIImage from \(url.path)."</span>,</span><br><span class="line">                    failureReason: <span class="string">"A UIImage could not be created out of the data in \(url.path)."</span>,</span><br><span class="line">                    recoverySuggestion: <span class="string">"Try deserializing \(url.path) manually after retrieving it as Data."</span></span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到， 对 Image 支持是有限制的，只支持 jpg/png 类型的图片，只是简单的转换为 imagedata 进行存储。</p>
<h3 id="encodable-data"><a href="#encodable-data" class="headerlink" title="encodable-data"></a>encodable-data</h3><p>encodable-data 是 swift4新加入的特性。使 class/struct 支持<code>Codable</code>协议，实现的对应的方法可以将其转换成其他数据格式，如 JSON。</p>
<p>在这里，disk 支持的是将遵循<code>Codable</code>实例存储为json object </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">save</span>&lt;T: Encodable&gt;<span class="params">(<span class="number">_</span> value: T, to directory: Directory, <span class="keyword">as</span> path: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> path.hasSuffix(<span class="string">"/"</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> createInvalidFileNameForStructsError()</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">do</span> &#123;</span><br><span class="line">           <span class="keyword">let</span> url = <span class="keyword">try</span> createURL(<span class="keyword">for</span>: path, <span class="keyword">in</span>: directory)</span><br><span class="line">           <span class="keyword">let</span> encoder = <span class="type">JSONEncoder</span>()</span><br><span class="line">           <span class="keyword">let</span> data = <span class="keyword">try</span> encoder.encode(value)</span><br><span class="line">           <span class="keyword">try</span> createSubfoldersBeforeCreatingFile(at: url)</span><br><span class="line">           <span class="keyword">try</span> data.write(to: url, options: .atomic)</span><br><span class="line">       &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> error</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>对于需要追加文件，先将原有数据读出，在内存中追加数据在后面，再将整个写入。   </p>
<h3 id="空间大小"><a href="#空间大小" class="headerlink" title="空间大小"></a>空间大小</h3><p><code>URLResourceValues</code>通过 URL 得到，可以对标准资源文件的空间大小进行判断</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/// Volume’s total capacity in bytes.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> totalCapacity: <span class="type">Int</span>? &#123;</span><br><span class="line">      <span class="keyword">get</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> resourceValues = getVolumeResourceValues(<span class="keyword">for</span>: .volumeTotalCapacityKey)</span><br><span class="line">          <span class="keyword">return</span> resourceValues?.volumeTotalCapacity</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// Volume’s available capacity in bytes.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> availableCapacity: <span class="type">Int</span>? &#123;</span><br><span class="line">      <span class="keyword">get</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> resourceValues = getVolumeResourceValues(<span class="keyword">for</span>: .volumeAvailableCapacityKey)</span><br><span class="line">          <span class="keyword">return</span> resourceValues?.volumeAvailableCapacity</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>注意以上特性都是在 iOS11之后特定的，需要加上<code>@available(iOS 11.0, *)</code></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/12/14/Disk---轻量级 swift 磁盘存储方案实现/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Alamofire 阅读" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/12/Alamofire 阅读/">Alamofire 阅读</a>
    </h1>
  

        
        <a href="/2017/11/12/Alamofire 阅读/" class="archive-article-date">
  	<time datetime="2017-11-12T11:32:29.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-11-12</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Alamofire-Swift-第一网络库"><a href="#Alamofire-Swift-第一网络库" class="headerlink" title="Alamofire Swift 第一网络库"></a>Alamofire Swift 第一网络库</h1><h2 id="开头"><a href="#开头" class="headerlink" title="开头"></a>开头</h2><p>Alamofire 是AFNetworking 的swift实现版本。相较于OC版本的AFNetwokring，swift简洁的语法和不再兼容connection方式，使得Alamofire的代码少了很多，同时Alamofire仍旧是swift平台上使用最多的移动端网络库。</p>
<h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><p><img src="https://i.imgur.com/bG0lMVY.jpg" alt=""></p>
<p>包含核心，特性，扩展，支持文件，对比兄弟OC的AFNetwokring可以说瘦身不少。</p>
<h2 id="核心文件"><a href="#核心文件" class="headerlink" title="核心文件"></a>核心文件</h2><p>根据文件名，不难看出每个文件的作用。主要包含了网络库的基本内容。</p>
<h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><p>request是处理请求的部分。包含了三个协议protocol</p>
<p><img src="https://i.imgur.com/GPilxiX.jpg" alt=""></p>
<p>requestAdapter 需要协议实现者实现将一个URLRequest处理成合适的方式<br>RequestRetrier 需要协议实现者实现是否需要将一个Request在完成回掉完成后发起重试<br>TaskConvertible 需要协议是实现者实现将输入的URLSession,输出URLSessionTask</p>
<p>之后实现了一个基类Request，对于网络请求的抽象</p>
<p><img src="https://i.imgur.com/1tw1WMu.jpg" alt=""></p>
<p>Request是对所有网络请求类型的抽象，其中包含一下类型</p>
<p><img src="https://i.imgur.com/6O0W8Yf.jpg" alt="-w652"></p>
<p>在初始化方法中，根据<code>requestTask</code>的类型，调用不同的taskDelegate 的初始化方法，初始化taskdelegate。在taskdelegate 中的 queue 中添加 operation</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.endTime = <span class="type">CFAbsoluteTimeGetCurrent</span>()</span><br></pre></td></tr></table></figure>
<p>下面的方法中大量使用<code>@discardableResult</code>来标记。<code>@discardableResult</code>的作用是告诉调用者可以忽略返回值。</p>
<p>authenticate 方法提供了 HTTP 基本的身份校验。默认</p>
<p><img src="media/15075176359047.jpg" alt=""></p>
<p>这两个方法都是返回 Self 的。对 Self 开始并不清楚，以下这段解释是我看的说的比较明白的</p>
<blockquote>
<p>而在声明接口时，我们希望在接口中使用的类型就是实现这个接口本身的类型的话，就需要使用 Self 进行指代。</p>
</blockquote>
<p>下面的三个方法实现了：恢复，挂起，取消</p>
<p><img src="media/15075181969697.jpg" alt=""></p>
<p>注意到，每次都用一个临时变量 task 去获取本地 task，这点很有意思。如果获取不到，就直接退出了，说明 task 已经结束或者不存在</p>
<p>接下来是实现了两个extension，都遵循<code>CustomStringConvertible</code>协议，自定义了<code>description</code>和<code>debugDescription</code>方法。其中<code>description</code>方法输出基本的请求信息，<code>debugDescription</code>则输出curl 方法</p>
<p>DataRequest 是 Request 的子类，用来管理<code>URLSessionDataTask</code></p>
<p><img src="media/15075192346340.jpg" alt=""></p>
<p>上述方法实现了<code>TaskConvertible</code>协议，尝试将自身的 urlRequest 转义，然后同步到 queue 中执行。</p>
<p>这里有个知识点： as! as? as</p>
<p>as 是向上转型，as!和 as?都是向下转型</p>
<p>as!和 as?不同的是：</p>
<p>as!如果转型失败会抛出 runtime 错误</p>
<p>as?转型返回可选类型，需要用户自行解包。</p>
<h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><p>response中前两个structs,分别为<code>DefaultDataResponse</code>和<code>DataResponse</code>，都实现了存储upload task的data存储。两者的区别是，<code>DataResponse</code>存储的是序列化后的data，<code>DefaultDataResponse</code>存储的是未序列化的data。</p>
<p>struct <code>DefaultDownloadResponse</code>实现的未序列化的<code>download request</code>的返回data。<code>DownloadResponse</code>存储的是序列化的<code>download request</code>的data。</p>
<p>对应的都实现了相关的extension，分别实现了<code>CustomStringConvertible</code>和<code>CustomDebugStringConvertible</code>两个协议。</p>
<p>其中，<code>DataResponse</code>和<code>DownloadResponse</code>中都有个result属性，这个属性也是Alamofire定义的。</p>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p>Result是一个enum枚举类型,分别有.success和.failure两个枚举值，以及关联值Value和Error。</p>
<p>值得注意的是，result 和 response一样，都通过 extension 实现了 map、flatMap 方法。提供这两个方法可以让外部通过闭包的形式对result进行处理</p>
<h3 id="TaskDelegate"><a href="#TaskDelegate" class="headerlink" title="TaskDelegate"></a>TaskDelegate</h3><p>TaskDelegate是负责所有代理回调和处理添加到任务执行队列任务的地方。</p>
<p>注意到属性task里面有几个知识点</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> task: <span class="type">URLSessionTask</span>? &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            taskLock.lock(); <span class="keyword">defer</span> &#123; taskLock.unlock() &#125;</span><br><span class="line">            _task = newValue</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            taskLock.lock(); <span class="keyword">defer</span> &#123; taskLock.unlock() &#125;</span><br><span class="line">            <span class="keyword">return</span> _task</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>首先set/get 时候用 Lock 进行加锁，原因是防止 task 在 读写的时候被其他线程进行了改动。其次，使用了 defer 字段包括了解锁部分的代码。defer 的作用是申明一段代码块无论如何都会执行。</p>
<blockquote>
<p>A defer statement defers execution until the current scope is exited. This statement consists of the defer keyword and the statements to be executed later. The deferred statements may not contain any code that would transfer control out of the statements, such as a break or a return statement, or by throwing an error. Deferred actions are executed in the reverse of the order that they’re written in your source code. That is, the code in the first defer statement executes last, the code in the second defer statement executes second to last, and so on. The last defer statement in source code order executes first.</p>
</blockquote>
<p>taskDelegate主要执行URLSession的回掉方法。</p>
<h3 id="SessionDelegate"><a href="#SessionDelegate" class="headerlink" title="SessionDelegate"></a>SessionDelegate</h3><p>SessionDelegate是对Session delegate回掉的封装。主要的属性都是一个回调闭包。</p>
<p>其中有三个个属性：<code>retrier</code>和<code>sessionManager</code>，<code>requests</code>。</p>
<p>retrier是一个<code>RequestRetrier</code>类型的属性。</p>
<p>sessionManager是<code>SessionManager</code>类型的属性</p>
<p>requests是[Int:Request]类型的字典</p>
<p>重写了<code>responds</code>方法，对不同系统不同selector做出判断。</p>
<p>SessionDelegate 通过 extension声明遵守了 <code>URLSessionDelegate</code> ， <code>URLSessionTaskDelegate</code>，<code>URLSessionDataDelegate</code>,<code>URLSessionDownloadDelegate</code>,<code>URLSessionStreamDelegate</code> protocol，因此实现了对应的方法</p>
<h3 id="SessionManager"><a href="#SessionManager" class="headerlink" title="SessionManager"></a>SessionManager</h3><p>sessionManager 可以说是 Alamofire 里面最重要的一部分了，主要负责管理 request 和其他在 URLSessionR下面的内容</p>
<p>对于 sessionManager，Alamofire 鼓励有且只有一个 sessionManager，除非如同 chrome safari这些浏览器一样需要有类似隐私模式</p>
<p>对于创建一个 queue，可以用以下的方式</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DispatchQueue</span>(label: <span class="string">"org.alamofire.session-manager."</span> + <span class="type">UUID</span>().uuidString)</span><br></pre></td></tr></table></figure>
<p>这样在堆栈跟踪的时候可以方便追溯。</p>
<p>在Sessionmanager里面大量使用了闭包求值的方式</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> alamofireVersion: <span class="type">String</span> = &#123;</span><br><span class="line">                   <span class="keyword">guard</span></span><br><span class="line">                       <span class="keyword">let</span> afInfo = <span class="type">Bundle</span>(<span class="keyword">for</span>: <span class="type">SessionManager</span>.<span class="keyword">self</span>).infoDictionary,</span><br><span class="line">                       <span class="keyword">let</span> build = afInfo[<span class="string">"CFBundleShortVersionString"</span>]</span><br><span class="line">                   <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">"Unknown"</span> &#125;</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">return</span> <span class="string">"Alamofire/\(build)"</span></span><br><span class="line">               &#125;()</span><br></pre></td></tr></table></figure>
<p>这种方式很有意思，用闭包初始化相较于普通属性初始化的好处在于可以更简单的初始化属性，特别是对于属性开始时需要一个默认的值。</p>
<p>但是使用闭包初始化的时候要注意，因为在闭包内部，有些值是不安全的</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> helloWorldLbl:<span class="type">UILabel</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> lbl = <span class="type">UILabel</span>()</span><br><span class="line">    lbl.text = <span class="keyword">self</span>.someFunctionToDetermineText() <span class="comment">//Compiler error</span></span><br><span class="line">    lbl.font = <span class="type">UIFont</span>.preferredFontForTextStyle(<span class="type">UIFontTextStyleBody</span>)</span><br><span class="line">    lbl.textColor = <span class="keyword">self</span>.myAppTheme.textColor() <span class="comment">//Another error</span></span><br><span class="line">    lbl.textAlignment = .<span class="type">Center</span></span><br><span class="line">    <span class="keyword">return</span> lbl</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>代码中的<code>self</code>就是不安全的，因为self可能没有初始化，同时self可能会引起循环调用。</p>
<p>其他的主要是URLSession的调用方法封装。</p>
<h3 id="AFError"><a href="#AFError" class="headerlink" title="AFError"></a>AFError</h3><p>AFError继承了Error，是Alamofire对error的封装。</p>
<p>没有太特别的东西，不过对于业务已经逻辑错误的封装，有很多可以学习的地方。</p>
<h3 id="Notifications"><a href="#Notifications" class="headerlink" title="Notifications"></a>Notifications</h3><p>封装了四种通知类型，提供一个扩展来提供一个key作为notification的userinfo的key</p>
<h3 id="ParameterEncoding"><a href="#ParameterEncoding" class="headerlink" title="ParameterEncoding"></a>ParameterEncoding</h3><p><code>ParameterEncoding</code>也是整个工程中非常重要的一个环节。我们知道在发送httpRequest的时候需要根据header中的<code>content-type</code>来确定我们的请求参数用什么样的方式去encode编码。<br><code>ParameterEncoding</code>就是用来对参数做encode的。</p>
<p><code>ParameterEncoding</code>中总共提供了三个struct，对应<code>URLEncoding</code>,<code>JSONEncoding</code>，<code>PropertyEncoding</code>。每个struct都遵循<code>ParameterEncoding</code>protocol，所以他们都需要实现对应的<code>encoding</code>方法</p>
<p> 在对字符串的处理上有些小技巧很值得借鉴，后面可以单独抽出来学习。</p>
<h3 id="MultipartFormData"><a href="#MultipartFormData" class="headerlink" title="MultipartFormData"></a>MultipartFormData</h3><p><code>MultipartFormData</code>是为upload中<code>multipart/form-data</code>类型提供encode方法。相比较<code>ParameterEncoding</code>不同，需要一些特殊处理</p>
<blockquote>
<p> Constructs <code>multipart/form-data</code> for uploads within an HTTP or HTTPS body. There are currently two ways to encode multipart form data. The first way is to encode the data directly in memory. This is very efficient, but can lead to memory issues if the dataset is too large. The second way is designed for larger datasets and will write all the<br> data to a single file on disk with all the proper boundary segmentation. The second approach MUST be used for larger datasets such as video content, otherwise your app may run out of memory when trying to encode the dataset.</p>
</blockquote>
<p>这部分展开了可以学习的太多了。这里主要了解是用来对上传encode就可以了。</p>
<h3 id="NetworkReachabilityManager"><a href="#NetworkReachabilityManager" class="headerlink" title="NetworkReachabilityManager"></a>NetworkReachabilityManager</h3><p><code>NetworkReachabilityManager</code>是Alamofire实现的网络状态管理工具方法。</p>
<p>通过<code>SCNetworkReachabilitySetCallback</code>回调监听系统网络变化。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> callbackEnabled = <span class="type">SCNetworkReachabilitySetCallback</span>(</span><br><span class="line">            reachability,</span><br><span class="line">            &#123; (<span class="number">_</span>, flags, info) <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> reachability = <span class="type">Unmanaged</span>&lt;<span class="type">NetworkReachabilityManager</span>&gt;.fromOpaque(info!).takeUnretainedValue()</span><br><span class="line">                reachability.notifyListener(flags)</span><br><span class="line">            &#125;,</span><br><span class="line">            &amp;context</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>以上方法将取得一个<code>NetworkReachabilityManager</code>实例，调用<code>notifyListener</code>方法将flags传递给回调方法。</p>
<p>在<code>NetworkReachabilityManager</code>最重要的一点就是学习如何在swift中管理C指针和C对象。</p>
<p>在<code>convenience init?</code>中，我们看到</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> reachability = <span class="built_in">withUnsafePointer</span>(to: &amp;address, &#123; pointer <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> pointer.withMemoryRebound(to: sockaddr.<span class="keyword">self</span>, capacity: <span class="type">MemoryLayout</span>&lt;sockaddr&gt;.size) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">SCNetworkReachabilityCreateWithAddress</span>(<span class="literal">nil</span>, $<span class="number">0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br></pre></td></tr></table></figure>
<p>这里将address作为指针传入，通过closure返回一个指针实例。<code>pointer.withMemoryRebound</code>是一次性绑定，将指针指定为指定的type.</p>
<h3 id="ResponseSerialization"><a href="#ResponseSerialization" class="headerlink" title="ResponseSerialization"></a>ResponseSerialization</h3><p><code>ResponseSerialization</code>中定义和实现了response的序列化方法。</p>
<h3 id="ServerTrustPolicy"><a href="#ServerTrustPolicy" class="headerlink" title="ServerTrustPolicy"></a>ServerTrustPolicy</h3><p><code>ServerTrustPolicy</code>实现的是服务器认证管理。</p>
<h3 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h3><p><code>Timeline</code>用来管理请求生命周期中的时间节点。</p>
<h3 id="validation"><a href="#validation" class="headerlink" title="validation"></a>validation</h3><p><code>validation</code>用来管理认证结果</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/11/12/Alamofire 阅读/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-iOSer该怎么做单测" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/14/iOSer该怎么做单测/">iOSer该怎么做单测</a>
    </h1>
  

        
        <a href="/2017/10/14/iOSer该怎么做单测/" class="archive-article-date">
  	<time datetime="2017-10-14T07:27:54.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-10-14</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文是作者在项目组内推行单元测试的一些心得总结。</p>
<h2 id="单元测试（Unit-Test）是什么"><a href="#单元测试（Unit-Test）是什么" class="headerlink" title="单元测试（Unit Test）是什么"></a>单元测试（Unit Test）是什么</h2><p>针对方法/函数进行独立测试，验证结果是否符合编写预期。</p>
<p>TDD：测试驱动<br>BDD：行为驱动</p>
<h2 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h2><ul>
<li>Fast — tests should be able to be executed often. 快速 – 应该随时和经常执行单测</li>
<li>Isolated — tests on their own cannot depend on external factors or on the result of another test. 独立 – 单测应该无需依赖外部实例或者依赖其他的测试结果</li>
<li>Repeatable — tests should have the same result every time we run them. 可重复 – 在不改动的情况下，多次执行应该返回相同的结果</li>
<li>Self-verifying — tests should include assertions; no human intervention needed. 自证 – 测试自身包括断言，无需人为干预</li>
<li>Timely — tests should be written along with the production code. 时效 – 单测应该随着开发进行伴随着成长</li>
</ul>
<h2 id="单元测试-测什么-不测什么"><a href="#单元测试-测什么-不测什么" class="headerlink" title="单元测试 测什么/不测什么"></a>单元测试 测什么/不测什么</h2><h3 id="测什么"><a href="#测什么" class="headerlink" title="测什么"></a>测什么</h3><ol>
<li>公开方法</li>
<li>依赖外部输入（网络请求、数据存储、交互操作）</li>
<li>工具方法</li>
</ol>
<p>公开方法（public api）是提供给外部（其他实体/用户）使用的。理论上，调用者是不清楚API 内部的实现细节的。因此，对公开方法的单测能够保证其结果符合实现预期。同时，单测可以提供给调用者参考使用。</p>
<p>依赖外部输入的方法，需要确定是否处理了对应的异常，已经异步操作是否符合预期。如网络操作，我们需要考虑在网络异常造成的种种问题，通过单测来覆盖异常情况。同时，对于这些异步操作，可以轻松构造不同的input 来检查。</p>
<p>工具方法（until method）是常用方法，通常为 pure function，因此工具方法最适合也最需要用单测来覆盖。</p>
<h3 id="不测什么"><a href="#不测什么" class="headerlink" title="不测什么"></a>不测什么</h3><ol>
<li>构造方法</li>
<li>私有方法</li>
</ol>
<p>构造方法无需测试的原因是，构造函数本身不没有其他行为，仅仅将外部传入的参数进行赋值。除此外，单元测试应该和实现细节剥离，而构造函数本身我们应该清楚就是生成实例对象，因此无需测试构造方法。</p>
<p>单测本身重视的是结果，不是实现细节。因此，私有方法本身对外是封闭的，不可知的。在不知道函数定义和内部实现的时候，是无法编写单元测试的（这点肯定有争议）。</p>
<h2 id="单元测试-怎么测"><a href="#单元测试-怎么测" class="headerlink" title="单元测试 怎么测"></a>单元测试 怎么测</h2><p>编写</p>
<ol>
<li>分析函数行为</li>
<li>抽离外部依赖（mockstub spy）</li>
<li>编写用例，判断是否符合逾期</li>
</ol>
<p>后续维护</p>
<ol>
<li>Find the test or tests that define the current behavior that you want to change. 找到测试方法是否已经不符合现在的逾期</li>
<li>Modify those tests to expect the new desired behavior.修改为当下符合预期</li>
<li>Run the tests and see if those modified tests fail. 测试，此时应该全部无法通过测试</li>
<li>Update your code to make all tests pass again. 修改方法，通过测试</li>
</ol>
<h2 id="从单元测试能获得什么"><a href="#从单元测试能获得什么" class="headerlink" title="从单元测试能获得什么"></a>从单元测试能获得什么</h2><ol>
<li>提高代码质量</li>
<li>提供重构依据</li>
<li>提供用例</li>
</ol>
<h3 id="延伸-–-单测为什么难写"><a href="#延伸-–-单测为什么难写" class="headerlink" title="延伸 – 单测为什么难写"></a>延伸 – 单测为什么难写</h3><p>在写单测的时候，很多时候无从下手，原因是方法实现过于复杂，方法定义没有说明方法预期行为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateRepaymentAccordingLastMonthBill:(BOOL)isUpdate card:(Card *)card</span><br></pre></td></tr></table></figure>
<p>根据注释，这个方法根据传入的卡片和是否更新月账单来更新。 因此测试的时候，我们需要构造<code>isUpdateLastestMonthBill</code>就可以判断是行为了。</p>
<p>但是</p>
<ol>
<li>这个方法返回是 void，那么是否就智能根据 <code>aCardVo</code>的属性来判断？如果这样，作为引用传参，<code>aCardVo</code>就被方法内部改变了</li>
<li>CardVo 是个很复杂的类，在这里有什么要求？</li>
</ol>
<p>再通过观察方法实现后发现</p>
<ol>
<li>定义了<code>isUpdate</code>，这点依赖无法在外部构造，因此无法进行测试</li>
<li>依赖了<code>isUpdate</code>为NO 的时候直接返回了，这一点无法在方法定义上提现</li>
<li>更新还款状态，进行了数据库操作，但没有判断数据库操作行为，无法判断最终行为结果</li>
</ol>
<p>综上，这个方法定义，如果根据原则，仅从方法定义上进行编写测试用例，是无法覆盖的。</p>
<p>因此，在遇到这些方法的时候，我们应该先抽离依赖，定义新的方法名，对新定义的方法名进行测试，然后将老的代码进行迁移。最后通过我们编写的测试。</p>
<h2 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h2><p>好的单测，本身是就是一个demo，一个说明，应该发生什么，不该发生什么。</p>
<p>测试用例本身就是具体业务的体现。如果业务过于复杂无法控制粒度，那么要如何在接口设计甚至整个业务模块上去做抽象拆分。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/10/14/iOSer该怎么做单测/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-MVVM、MVC、VIPER，孰优孰劣" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/20/MVVM、MVC、VIPER，孰优孰劣/">MVVM、MVC、VIPER，孰优孰劣</a>
    </h1>
  

        
        <a href="/2017/05/20/MVVM、MVC、VIPER，孰优孰劣/" class="archive-article-date">
  	<time datetime="2017-05-20T07:22:21.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-05-20</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="优秀的-iOS-应用架构：MVVM、MVC、VIPER，孰优孰劣？"><a href="#优秀的-iOS-应用架构：MVVM、MVC、VIPER，孰优孰劣？" class="headerlink" title="优秀的 iOS 应用架构：MVVM、MVC、VIPER，孰优孰劣？"></a><a href="https://news.realm.io/cn/news/krzysztof-zablocki-mDevCamp-ios-architecture-mvvm-mvc-viper/" target="_blank" rel="noopener">优秀的 iOS 应用架构：MVVM、MVC、VIPER，孰优孰劣？</a></h1><p> <a href="https://news.realm.io/news/krzysztof-zablocki-mDevCamp-ios-architecture-mvvm-mvc-viper/" target="_blank" rel="noopener">英文原版</a></p>
<p>内容非常丰富的一篇讲应用架构的文章，花了挺多时间来看，还没看的很懂。</p>
<h2 id="什么是好的软件架构"><a href="#什么是好的软件架构" class="headerlink" title="什么是好的软件架构"></a>什么是好的软件架构</h2><p><strong>each object to have a specific, clear role</strong></p>
<p>这句话我的理解是，每个对象拥有自己的特有的，清晰的定位。</p>
<p>这样的好处的是，每个对象之间职责清晰明确，模糊的边界几乎不存在。便于阅读，维护，组装。</p>
<p>同时，单向数据流也是被推崇的。单项数据流可以轻松的把握数据传递的路径，避免混乱的边界问题。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>topic这里讲述的方式是通过TDD。</p>
<p>这点国内和国外的最大不同在于，国外注重测试点，必须通过测试。</p>
<p>国内基本没有自动化的测试用例，依赖人工测试，快速迭代。</p>
<p>TDD不适用于敏捷开发，测试用例变动太大。</p>
<p>此外，由于大量业务逻辑混杂和耦合，无法明确边界，无法便于测试。</p>
<p>topic这里强调，如果开发者认为测试用例难以编写，说明架构已经出现了很大的问题（这里的确是）</p>
<h2 id="什么是坏架构"><a href="#什么是坏架构" class="headerlink" title="什么是坏架构"></a>什么是坏架构</h2><p>第一点，每个执行文件的代码行数。</p>
<p>topic举了个例子，如果一个swift的viewcontroller行数多于3000行，或者专用的测试超过4000，这就是一个明显的信号。</p>
<p><strong> global states and Up Delegate</strong>，这两个也是topic中提到的问题。</p>
<p>全局变量最大的问题我们无法明确值在哪里被改变了。</p>
<p>up delegate(代理提升？）这个概念真的不清楚。</p>
<p>up delegate 会造成大量class关联在一起。</p>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p><strong>SOLID principle </strong> 当然是最经典的。但是topic这里没有讲这个，而是一点人生经验。</p>
<p>topic这里提到，设计模式是为了解决一类问题的方法定式。多数人沉迷某一种模式，认为是万金油，其实这是不对。离开了特定的问题，设计模式是没有用处的。这里提到了单例，我认同这种观点。单例本身不是一个坏的设计模式，而是滥用造成了单例泛滥。单例的目的是为了解决资源竞争的问题。或者通过通用设定去访问数据库或者某些接口。而在ios里，许多使用单例仅仅是为了全局同步。</p>
<p>logger日志是一个很好的例子，为了打印一个日志，我们不必要将logger传入每一个类中。</p>
<p>即使用了单例，我们也不一定要在接口中暴露出来，尤其是swift。</p>
<h2 id="Composition组合模式"><a href="#Composition组合模式" class="headerlink" title="Composition组合模式"></a>Composition组合模式</h2><p>topic认为，如果有一种模式值得推荐，那么就是组合模式。因为topic认为，如果遵循组合模式的准则，那么一切部分都是遵循<strong>single responsibility 单一职责</strong></p>
<p>遵循组合模式可以很容易的去注入，方便测试。</p>
<p>unity引擎是一个很好的例子。</p>
<p>另外一种很好的模式是<strong>依赖注入</strong>（这里存疑，我不认为依赖注入是一种很好的模式）</p>
<p>topic认为，小的对象，为何需要硬编码，只需通过依赖注入而不需要专门创建接口。</p>
<h2 id="流行架构模式"><a href="#流行架构模式" class="headerlink" title="流行架构模式"></a>流行架构模式</h2><h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p>这里的MVC是传统的MVC。传统MVC适合WEB（传统的web）。</p>
<p>在apple的mvc中。viewcontroller承担者mediator这和controller的职责，和view的生命周期绑定非常紧密，因此vc非常容易变得非常臃肿。因为vc无法复用，因此view也极其难复用。</p>
<p>在vc中，会执行网络下载，数据处理，数据绑定，业务逻辑，因此非常非常难写测试用例。因此，绝大多数的vc是没有测试 用例的</p>
<h3 id="Viper"><a href="#Viper" class="headerlink" title="Viper"></a>Viper</h3><p>相对于viper，MVC/APPLE MVC更像是UI 模式。viper是第一个考虑如何解决整个设计架构的。</p>
<p>在viper中，interactor负责业务逻辑，组合不同service。 Router负责管理跳转逻辑，管理uikit framework。Presenter负责和uiKit 无关的展示逻辑。</p>
<p>viper很棒，但是需要非常多的模板代码，因此很少人使用。</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>topic认为，MVVM是现在最适合ios的架构。</p>
<p>MVVM可以非常容易去测试view model。view model 不包含UI kit，因此和view controller的生命周期无关。</p>
<p>不受用FRP（函数变成）也可以创建完整的MVVM模式，但是使用使用起来会更加好。</p>
<p>MVC只能完成30%的测试覆盖的话，MVVM可以提高到70%甚至更高。</p>
<p>虽然MVVM是最流行的架构之一，但是很多人误解了她的用法。MVVM的优势在于便于测试，可以不依赖view controller的生命周期来测试view model中的业务逻辑。</p>
<p>唯一无法解决的测试问题在于，VC生命周期中的绑定。</p>
<p>这里举了一个例子。</p>
<p>有一个view controller A，拥有一个依赖，这时候需要添加另外一个view controller，这个B需要观察数据，这个时候，A就需要拥有B的依赖了。如果这时候还需要添加其他的view controller，那么A就变成一大堆的view controller的池子（这比喻很有意思）</p>
<p>因此，MVVM中大量的优点被这个问题掩盖掉了。</p>
<p>怎么解决呢？</p>
<p>事实上，我们希望不相关的view model之间互不依赖。为了更简单的去测试VM，topic提出了MVVM+。MVVM+意味着 <strong>MVVM with flow coordinator</strong>。这里，topic提到了<strong>redux</strong>。</p>
<p>通过flow coordinator，将view controller作为一个黑盒来使用。例如一个用户设置页面，我们只需要关心save和cancel操作。</p>
<h2 id="Flow-Coordinato"><a href="#Flow-Coordinato" class="headerlink" title="Flow Coordinato"></a>Flow Coordinato</h2><p><strong>Flow Coordinato</strong> 是管理view controller的地方，准确的来说是决定展示的内容的地方。controller不需要去关心是怎么配置的，甚至可以将一个view controller配置到不同的child controller下。</p>
<p><strong>Flow Coordinato</strong>可以很好的消灭<code>if</code>判断</p>
<h2 id="ReSwift"><a href="#ReSwift" class="headerlink" title="ReSwift"></a>ReSwift</h2><p><strong>ReSwift</strong>是非常好的三方库，使用了redux的实现，非常利于测试。这点，在react的开发中我深刻感受到了。redux的设计非常利于状态的回放。由于状态的更改都是利用纯函数，因此利于测试。</p>
<h2 id="Conclusion（总结）"><a href="#Conclusion（总结）" class="headerlink" title="Conclusion（总结）"></a>Conclusion（总结）</h2><p>这个topic真的非常长，提到的内容太多，一时很难消化。</p>
<p>事实上，没有最好的框架，正如topic一开始讲到的。一切框架都是为了解决特定的问题去实现的。i开了具体问题谈论框架是没有意义的。可以看到，viper和MVVM都有自己独特的优点。在可测试性上都有很强的提升。但是，viper大量的模板代码和MVVM难以解决的vc bind的问题，让很多开发者望而却步。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/05/20/MVVM、MVC、VIPER，孰优孰劣/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-重新理解MVC" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/14/重新理解MVC/">Do MVC like it’s 1979</a>
    </h1>
  

        
        <a href="/2017/05/14/重新理解MVC/" class="archive-article-date">
  	<time datetime="2017-05-14T06:57:31.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-05-14</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Do-MVC-like-it’s-1979"><a href="#Do-MVC-like-it’s-1979" class="headerlink" title="Do MVC like it’s 1979"></a>Do MVC like it’s 1979</h1><p>文章内容：<a href="https://badootech.badoo.com/do-mvc-like-its-1979-da62304f6568" target="_blank" rel="noopener">链接</a></p>
<p>文章讲了1979年最开始提出 MVC概念时的观点和现在 iOS 流行的 MVC 对比</p>
<h2 id="controller-or-editor"><a href="#controller-or-editor" class="headerlink" title="controller or editor"></a>controller or editor</h2><p>在最开始，controller 应该被称为 editor，负责去update view，到了后面才被称为 controller</p>
<h2 id="流程改变"><a href="#流程改变" class="headerlink" title="流程改变"></a>流程改变</h2><p><img src="https://i.imgur.com/FDJlFry.jpg" alt=""></p>
<p>最早的MVC 架构如上，可见违反了一些我们共同认知的软件设计原则：</p>
<ul>
<li>Single responsibility单一原则。controller 和 view 都能去改变 model</li>
<li>Loose coupling and high cohesion 松耦合和高内聚。由于model 依赖于 view 和 controller，所以如果修改接口，会影响其他的实体。</li>
</ul>
<p>所以，最早的的MVC 模型是不适用的。</p>
<p>apple 提出的 MVC 模型如下<br><img src="https://i.imgur.com/whvBgxf.jpg" alt=""></p>
<p>可见，apple 的 mvc 模型会导致大量的逻辑堆积在一个实体上，比如 controller。多数用户没能很好应用 model 去承载业务逻辑。</p>
<h2 id="从-MVC-设计中学习"><a href="#从-MVC-设计中学习" class="headerlink" title="从 MVC 设计中学习"></a>从 MVC 设计中学习</h2><p>不把 MVC 仅当做一个架构，作为一种设计理念，可以学习到以下内容</p>
<h3 id="分离。"><a href="#分离。" class="headerlink" title="分离。"></a>分离。</h3><p> MVC 定义了三个组件来承担逻辑。</p>
<h3 id="Facade。（外观模式）"><a href="#Facade。（外观模式）" class="headerlink" title="Facade。（外观模式）"></a>Facade。（外观模式）</h3><p>通常开发忽略了在 model中处理共用逻辑，而全部放在了 controller 中。因此造成了胖 controller 和 瘦 model 。facade 意味这一个对象隐藏了大量的逻辑实现。避免直接和 model 进行沟通。外观模式保证了 model 在增长的过程中不影响上层。</p>
<p><img src="https://i.imgur.com/1U1TdO0.jpg" alt=""></p>
<p><img src="https://i.imgur.com/AEz8QfN.jpg" alt=""></p>
<h3 id="观察者"><a href="#观察者" class="headerlink" title="观察者"></a>观察者</h3><p>观察者是一种通用的来对 model 解耦的方法。通常的做法是，model 不关心谁需要知道状态变更，而是发出状态变更的通知。相关观察了 model 的实体会去接收通知，执行对应的逻辑。</p>
<p><img src="https://i.imgur.com/4Ueu1XU.jpg" alt=""></p>
<p>通过观察者模式，可以讲 model layer设计成独立的服务。服务的生命周期等同于应用的声明周期。如网络服务，统计服务，聊天服务。</p>
<p><img src="https://i.imgur.com/2PXP8vh.jpg" alt=""></p>
<h3 id="Mediator-传递者）"><a href="#Mediator-传递者）" class="headerlink" title="Mediator(传递者）"></a>Mediator(传递者）</h3><p>在 MVC中，controller 承担着 mediator 的责任。一个对象，依赖越多，承担的逻辑应该越少（这里应该认为，如果承担过多的逻辑，修改的成本很高）</p>
<p>controller 因此会承担很多浇水代码。</p>
<p><img src="https://i.imgur.com/0c0LniB.jpg" alt=""></p>
<p>因为 controller 的胶水属性，尽可能避免在 controller 中保存状态值，以 model 的 computer interface 来计算出来</p>
<h2 id="现代工程的-MVC"><a href="#现代工程的-MVC" class="headerlink" title="现代工程的 MVC"></a>现代工程的 MVC</h2><h3 id="APPLE-MVC"><a href="#APPLE-MVC" class="headerlink" title="APPLE MVC"></a>APPLE MVC</h3><p><img src="https://i.imgur.com/qQFSRlb.jpg" alt=""></p>
<p>常见的 iOS 架构设计，苹果经典的 MVC。</p>
<p>viewController 同时担任了 view 和 controller的职责</p>
<p>缺点 controller 臃肿</p>
<h3 id="MVP-MVVM"><a href="#MVP-MVVM" class="headerlink" title="MVP/MVVM"></a>MVP/MVVM</h3><p><img src="https://i.imgur.com/suzhJVs.jpg" alt=""></p>
<p><img src="https://i.imgur.com/SG04HIu.jpg" alt=""></p>
<p>强调了单一原则。</p>
<h3 id="VIPER-Riblets"><a href="#VIPER-Riblets" class="headerlink" title="VIPER/Riblets"></a>VIPER/Riblets</h3><p><img src="https://i.imgur.com/zb73Mr7.jpg" alt=""></p>
<p>和 MVX 的不同在于改变了形态，使用 Service/Repository/Storage<br>至少有两个 controller ，分别为 router(路由)，presenter(展示器)</p>
<h2 id="学到了什么"><a href="#学到了什么" class="headerlink" title="学到了什么"></a>学到了什么</h2><ul>
<li>不要把 MVC 仅仅当做一种架构，而是一种架构设计的思想</li>
<li>不仅仅能解释一种架构，而是理解每种架构解决的问题</li>
<li>apple 的MVC 解决了他们的问题，但不一定适合自己的问题</li>
<li>避免过度设计，在不必要的时候无需拆分</li>
<li>以用户更流畅的使用，而不是让开发者更轻松</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/05/14/重新理解MVC/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-2017-03-10-再认识一次『锁』" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/2017-03-10-再认识一次『锁』/">再认识一次『锁』</a>
    </h1>
  

        
        <a href="/2017/03/10/2017-03-10-再认识一次『锁』/" class="archive-article-date">
  	<time datetime="2017-03-10T06:57:31.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-03-10</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="时间片轮转调度算法"><a href="#时间片轮转调度算法" class="headerlink" title="时间片轮转调度算法"></a>时间片轮转调度算法</h3><p>系统给每个线程分配一个时间片(100ms)，当线程分配的时间片消耗完，会被移动到队列尾部。</p>
<h3 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h3><p>操作不可再分割，不可终端</p>
<h3 id="临界区"><a href="#临界区" class="headerlink" title="临界区"></a>临界区</h3><p>访问临界资源的代码块。每次只允许一个进程进入临界区。</p>
<h3 id="忙等"><a href="#忙等" class="headerlink" title="忙等"></a>忙等</h3><p>试图进入临界区的线程，占着CPU而不释放的状态</p>
<h3 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h3><p>如果一个线程无法获取互斥量，这个线程将会被挂起。当其他线程释放互斥锁的时候，系统将会唤醒被挂起的线程。互斥锁会使得线程阻塞。阻塞有两个阶段。第一个阶段将空转，不停去尝试获取锁。第二个阶段将会进入 waiting 阶段，不再消耗 CPU资源，直到被系统唤醒。</p>
<h3 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h3><p>自旋锁不会被挂起，将会不停消耗资源去获取锁。</p>
<h2 id="NSLock-amp-amp-pthread-mutex-lock-互斥锁"><a href="#NSLock-amp-amp-pthread-mutex-lock-互斥锁" class="headerlink" title="NSLock &amp;&amp; pthread_mutex_lock 互斥锁"></a>NSLock &amp;&amp; pthread_mutex_lock 互斥锁</h2><p><code>NSLock</code> 是 Objective-C 以对象的形式暴露给开发者的一种锁。</p>
<p><code>pthread_mutex_lock</code>是POSIX互斥锁</p>
<p><code>NSLock</code>比<code>pthread_mutex_lock</code>慢的原因是经过的方法调用（runtime）。但是 runtime 会对方法调用进行缓存，所以多次调用不会有性能影响。</p>
<h2 id="NSRecursiveLock-递归锁"><a href="#NSRecursiveLock-递归锁" class="headerlink" title="NSRecursiveLock 递归锁"></a>NSRecursiveLock 递归锁</h2><p>递归锁可以在同一个线程被多次获得，解锁的条件就是加锁的次数和解锁的次数一样多。</p>
<p>NSRecursiveLock 与 NSLock 的区别在于内部封装的 pthread_mutex_t 对象的类型不同，前者的类型为 <code>PTHREAD_MUTEX_RECURSIVE</code></p>
<h2 id="NSConditionLock-amp-amp-NSCondition"><a href="#NSConditionLock-amp-amp-NSCondition" class="headerlink" title="NSConditionLock &amp;&amp; NSCondition"></a>NSConditionLock &amp;&amp; NSCondition</h2><p>条件锁，看到用的地方不多。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface NSConditionLock : NSObject &lt;NSLocking&gt; &#123;</span><br><span class="line">@private</span><br><span class="line">    void *_priv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithCondition:(NSInteger)condition NS_DESIGNATED_INITIALIZER;</span><br><span class="line"></span><br><span class="line">@property (readonly) NSInteger condition;</span><br><span class="line">- (void)lockWhenCondition:(NSInteger)condition;</span><br><span class="line">- (BOOL)tryLock;</span><br><span class="line">- (BOOL)tryLockWhenCondition:(NSInteger)condition;</span><br><span class="line">- (void)unlockWithCondition:(NSInteger)condition;</span><br><span class="line">- (BOOL)lockBeforeDate:(NSDate *)limit;</span><br><span class="line">- (BOOL)lockWhenCondition:(NSInteger)condition beforeDate:(NSDate *)limit;</span><br><span class="line"></span><br><span class="line">@property (nullable, copy) NSString *name API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>和 NSLock 类似，不同的地方是加锁和解锁只有在符合条件的时候。</p>
<p>根据<a href="https://mp.weixin.qq.com/s/e2VA7-E01OopF-ObPE3YOQ" target="_blank" rel="noopener">白夜追凶，揭开iOS锁的秘密</a>一文。</p>
<blockquote>
<p>NSCondition的底层是通过条件变量(Condition variable) pthread_cond_t 来实现的。条件变量有点像信号量，提供了线程阻塞与信号机制，因此可以用来阻塞某个线程，并等待某个数据就绪，随后唤醒线程。其组成结构是</p>
</blockquote>
<p><img src="media/15136623668368.jpg" alt=""></p>
<blockquote>
<p>信号量可以一定程度上替代 Condition，但是互斥锁不行。在以上给出的生产者-消费者模式的代码中， pthread_cond_wait 方法的本质是锁的转移，消费者放弃锁，然后生产者获得锁，同理， pthread_cond_signal 则是一个锁从生产者到消费者转移的过程。</p>
<p>这样做存在的问题在于，在等待 another_lock 之前， 生产者有可能先执行代码， 从而释放了 another_lock。也就是说，我们无法保证释放锁和等待另一个锁这两个操作是原子性的，也就无法保证“先等待、后释放 another_lock” 这个顺序。</p>
<p>用信号量则不存在这个问题，因为信号量的等待和唤醒并不需要满足先后顺序，信号量只表示有多少个资源可用，因此不存在上述问题。然而与 pthread_cond_wait 保证的原子性锁转移相比，使用信号量似乎存在一定风险(暂时没有查到非原子性操作有何不妥)。</p>
<p>不过，使用 Condition 有一个好处，我们可以调用 pthread_cond_broadcast 方法通知所有等待中的消费者，这是使用信号量无法实现的。</p>
</blockquote>
<p>NSCondition封装了互斥锁和信号量，将 lock/signal/wait 封装起来提供给开发者。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[condition wait];让当前线程处于等待状态</span><br><span class="line"></span><br><span class="line">[condition signal];CPU发信号告诉线程不用在等待，可以继续执行</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意的是： NSCondition 的对象实际上作为一个锁和一个线程检查器，锁上之后其它线程也能上锁，而之后可以根据条件决定是否继续运行线程，即线程是否要进入 waiting 状态，经测试， NSCondition 并不会像上文的那些锁一样，先轮询，而是直接进入 waiting 状态，当其它线程中的该锁执行 signal 或者 broadcast 方法时，线程被唤醒，继续运行之后的方法。</p>
<p>NSCondition 信号只能发送，不能保存（如果没有线程在等待，则发送的信号会失效）</p>
</blockquote>
<p>总结步骤如下</p>
<ol>
<li>锁定条件对象</li>
<li>判断是否可以进入临界区</li>
<li>加入不可以进入，调用 <code>wait/waitUntilDate:</code>来阻塞线程。待方法返回时，继续检查是否可以执行下面的任务，直到可以进入或超时。</li>
<li>执行任务</li>
<li>释放条件对象</li>
</ol>
<h2 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h2><p><code>@synchronized</code>是最常用一种加锁方式。传入一个对象作为锁定标记可以起到锁的作用。</p>
<p>@synchronized 将传入的对象地址的 hash 值作为 key,将SyncData作为 value。</p>
<blockquote>
<p>传递给 @synchronized指令的对象是用于区分受保护块的唯一标识符。如果在两个不同的线程中执行上述方法，则在每个线程上为anObj参数传递一个不同的对象，每个线程都会锁定并继续处理而不被另一个线程阻塞。但是，如果在两种情况下传递相同的对象，则其中一个线程将首先获取锁，另一个会阻塞，直到第一个线程完成临界区。</p>
</blockquote>
<p>需要注意的问题有几个</p>
<ol>
<li>你调用 sychronized 的每个对象，Objective-C runtime 都会为其分配一个递归锁并存储在哈希表中。</li>
<li>如果在 sychronized 内部对象被释放或被设为 nil 看起来都 OK。不过这没在文档中说明，所以我不会再生产代码中依赖这条。注意不要向你的 sychronized block 传入 nil！这将会从代码中移走线程安全。你可以通过在 objc_sync_nil 上加断点来查看是否发生了这样的事情。</li>
</ol>
<h2 id="dispatch-semaphore"><a href="#dispatch-semaphore" class="headerlink" title="dispatch_semaphore"></a>dispatch_semaphore</h2><p><code>dispatch_semaphore</code> 是 GCD用来实现同步的一种方式，即信号量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_create(long value);</span><br><span class="line">dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout);</span><br><span class="line">dispatch_semaphore_signal(dispatch_semaphore_t dsema);</span><br></pre></td></tr></table></figure>
<p>dispatch_semaphore 和 NSCondition 类似，都是一种基于信号的同步方式， dispatch_semaphore 能保存发送的信号。 dispatch_semaphore 的核心是 dispatch_semaphore_t 类型的信号量。</p>
<p><code>dispatch_semaphore_create(1)</code>会创建一个<code>dispatch_semaphore_t</code>的信号量，初始值为1。这里必须传如非负数的，否则会返回 NULL。只有创建为1的时候才能作为锁，否则可能会有多个线程访问临界区。</p>
<p>dispatch_semaphore_wait (signal, overTime); 方法会判断 signal 的信号值是否大于 0。大于 0 不会阻塞线程，消耗掉一个信号，执行后续任务。如果信号值为 0，该线程会和 NSCondition 一样直接进入 waiting 状态，等待其他线程发送信号唤醒线程去执行后续任务，或者当 overTime 时限到了，也会执行后续任务。</p>
<p>dispatch_semaphore_signal(signal); 发送信号，如果没有等待的线程接受信号，则使 signal 信号值加一（做到对信号的保存）</p>
<h2 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h2><ol>
<li>如果应用在递归场景的时候，我们有2种选择，一个是 NSRecursiveLock，另一个是 pthread_mutex(recursive)。追求高性能的话，优先选择 pthread_mutex，苹果已对 pthread_mutex进行过多次优化。</li>
<li>普通场景可以用@synchronized，但是加锁解锁效率最慢。建议是用<code>dispatch_semaphore</code>或者<code>pthread_mutex</code></li>
</ol>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/03/10/2017-03-10-再认识一次『锁』/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-2017-01-10-持久化学习系列2" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/10/2017-01-10-持久化学习系列2/">持久化学习系列2</a>
    </h1>
  

        
        <a href="/2017/01/10/2017-01-10-持久化学习系列2/" class="archive-article-date">
  	<time datetime="2017-01-10T15:10:33.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-01-10</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PINCache"><a href="#PINCache" class="headerlink" title="PINCache"></a>PINCache</h1><p>第二篇是关于最经典的KV缓存解决方案<code>PINCache</code></p>
<h2 id="客户端的存储"><a href="#客户端的存储" class="headerlink" title="客户端的存储"></a>客户端的存储</h2><p>在正式讲解<code>PINCache</code>前，先来谈谈客户端什么时候需要做存储。</p>
<p>总所周知，现在的APP越来越依赖网络，在离开网络的情况下，绝大多数的APP都成了摆设。然而，优秀的APP已经有自己的一套设计，避免在无网或者弱网的情况下完全失去作用。例如微信这样的强网络要求的APP,在失去网络的情况依然能够浏览本地缓存的聊天信息和朋友圈记录。优秀的APP，应该根据自己的业务需求，选择合适的存储方案。对于一般体量的APP来说，利用KV形式的存储是最好不过的选择。</p>
<p>KV，即Key-Value形式的存储。通常客户端的信息是由后端给出的json解析的,使用Key-Value正是方便了这种格式。</p>
<h2 id="PINCache-1"><a href="#PINCache-1" class="headerlink" title="PINCache"></a>PINCache</h2><p><code>PINCache</code>是脱胎于<code>TMCache</code>，解决了<code>TMCache</code>中的线程死锁问题。<code>PINCache</code>中依然设计了<code>memoryCache</code>和<code>diskCache</code>两种，分别解决了临时存储和长期持久化的问题。<br>在<code>PINCache</code>的github主页上，提出在iOS上如果没有特别的情况，尽可能使用<code>diskCache</code>，原因是每次iOS应用启动，都会造成<code>memoryCache</code>中的内容被清空。在下面，会对比下内存缓存和磁盘缓存的优缺点，以及<code>PINCache</code>是如何实现的，</p>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p><img src="../media/14838580770949.jpg" alt=""></p>
<p>从图上可以看到，<code>PINCache</code>的实现并不复杂，除去<code>PINCache</code>本身实现对外的方法外，总共只有八个实现文件。</p>
<h3 id="PINMemoryCache"><a href="#PINMemoryCache" class="headerlink" title="PINMemoryCache"></a>PINMemoryCache</h3><p><code>PINMemoryCache</code>为实现内存缓存的类。什么是内存缓存，我们可以理解为通过一个<code>NSMutableDictionary</code>来临时存储对象。实现一个内存缓存难度不大，通常需要完成以下几个事情：</p>
<ol>
<li>选择合适的存储结构</li>
<li>选择和实现对应的读写方法</li>
<li>选择和实现淘汰方法</li>
<li>处理系统内存警告</li>
</ol>
<p>了解了以上步骤，我们来看看<code>PINMemoryCache</code>是怎么解决上面的问题</p>
<ol>
<li>选择<code>NSMutableDictionary</code>作为存储结构</li>
<li>采用<code>NSMutableDictionary</code>的读写方法</li>
<li>通过两个<code>NSMutableDictionary</code>分别记录<code>date</code>和<code>cost</code>,实现时间和内容的管理。</li>
<li>收到内存警告后，清空内存中所有的对象，清空缓存。</li>
</ol>
<p>看上去不难？在笔者看来，实现内存缓存的难度主要是2，3点。在这里，<code>PINMemoryCache</code>主要考虑的是如何解决多线程安全的问题，以及缓存淘汰问题。</p>
<h4 id="多线程安全"><a href="#多线程安全" class="headerlink" title="多线程安全"></a>多线程安全</h4><p>由于缓存的特殊性，读写必须考虑到多线程安全的问题。如果一个线程改变了缓存中的某个值，而别的线正好需要这个值，处理不好轻则造成数据出错，重则造成程序崩溃。</p>
<p>在<code>PINMemoryCache</code>中，使用了<code>pthread_mutex_t</code>来保证线程安全。</p>
<p><code>pthread_mutex_t</code>为互斥锁，当锁上的时候，其他线程就无法访问被锁上的资源</p>
<p>使用<code>pthread_mutex_t</code>需要注意几点。</p>
<p><strong>必须在<code>dealloc</code>方法中主动释放</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</span><br><span class="line"></span><br><span class="line">    __unused <span class="keyword">int</span> result = pthread_mutex_destroy(&amp;_mutex);</span><br><span class="line">    <span class="built_in">NSCAssert</span>(result == <span class="number">0</span>, <span class="string">@"Failed to destroy lock in PINMemoryCache %p. Code: %d"</span>, (<span class="keyword">void</span> *)<span class="keyword">self</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 单独使用<code>pthread_mutex_t</code>容易造成<strong>死锁</strong>，同时也坑你造成效率不高，可以通过实现对应的递归锁来避免</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pthread_mutexattr_t attr;</span><br><span class="line">pthread_mutexattr_init(&amp;attr);</span><br><span class="line">pthread_mutexattr_settype(&amp;attr,PTHREAD_MUTEX_RECURSIVE);</span><br><span class="line">pthread_mutex_init(&amp;lock, &amp;attr);</span><br><span class="line">pthread_mutexattr_destroy(&amp;attr);</span><br></pre></td></tr></table></figure>
<p>在完成锁的初始化后，就需要考虑什么时候要加锁解锁了</p>
<p>为了避免<strong>data race</strong>的情况，在这里，<code>PINMemoryCache</code>选择了对所有读写操作都进行加锁。同时，采用副本的形式避免读取的数据被篡改。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">- (__<span class="keyword">nullable</span> <span class="keyword">id</span>)objectForKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSDate</span> *now = [[<span class="built_in">NSDate</span> alloc] init];</span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">        <span class="keyword">id</span> object = <span class="literal">nil</span>;</span><br><span class="line">        <span class="comment">// If the cache should behave like a TTL cache, then only fetch the object if there's a valid ageLimit and  the object is still alive</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>-&gt;_ttlCache || <span class="keyword">self</span>-&gt;_ageLimit &lt;= <span class="number">0</span> || fabs([[_dates objectForKey:key] timeIntervalSinceDate:now]) &lt; <span class="keyword">self</span>-&gt;_ageLimit) &#123;</span><br><span class="line">            object = _dictionary[key];</span><br><span class="line">        &#125;</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (object) &#123;</span><br><span class="line">        [<span class="keyword">self</span> lock];</span><br><span class="line">            _dates[key] = now;</span><br><span class="line">        [<span class="keyword">self</span> unlock];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)object forKey:(<span class="built_in">NSString</span> *)key withCost:(<span class="built_in">NSUInteger</span>)cost</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!key || !object)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">        PINMemoryCacheObjectBlock willAddObjectBlock = _willAddObjectBlock;</span><br><span class="line">        PINMemoryCacheObjectBlock didAddObjectBlock = _didAddObjectBlock;</span><br><span class="line">        <span class="built_in">NSUInteger</span> costLimit = _costLimit;</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (willAddObjectBlock)</span><br><span class="line">        willAddObjectBlock(<span class="keyword">self</span>, key, object);</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">        <span class="built_in">NSNumber</span>* oldCost = _costs[key];</span><br><span class="line">        <span class="keyword">if</span> (oldCost)</span><br><span class="line">            _totalCost -= [oldCost unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line">        _dictionary[key] = object;</span><br><span class="line">        _dates[key] = [[<span class="built_in">NSDate</span> alloc] init];</span><br><span class="line">        _costs[key] = @(cost);</span><br><span class="line">        </span><br><span class="line">        _totalCost += cost;</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (didAddObjectBlock)</span><br><span class="line">        didAddObjectBlock(<span class="keyword">self</span>, key, object);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (costLimit &gt; <span class="number">0</span>)</span><br><span class="line">        [<span class="keyword">self</span> trimToCostByDate:costLimit];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这两个读写方法，我们发现，<code>PINMemoryCache</code>对任何涉及属性操作的地方都进行了锁操作，避免了<strong>data race</strong>的情况。</p>
<h4 id="缓存淘汰"><a href="#缓存淘汰" class="headerlink" title="缓存淘汰"></a>缓存淘汰</h4><p>缓存淘汰，也就是第三点。如果保证缓存中数据有效性，保证缓存搞笑的利用是所有缓存应该考虑的问题。通常来讲，我们应该从缓存利用率上来着手，只保留常被使用的数据，淘汰长期不需要的数据。LRU就会常用的一种缓存淘汰算法。在这里，<code>PINMemoryCache</code>通过时间和空间来实现的LRU算法。</p>
<p>在上面贴出的读写中，读的时候，更新<code>date</code>中key对应的时间。在写的时候，记录或更新key对应时间。</p>
<p>当触发缓存删除操作的时候，优先删除占用空间大和使用时间靠前的的内容。</p>
<p>至此，<code>PINMemoryCache</code>的内容基本就分析完了。内存缓存的实现，只要考虑清楚上面列的四个内容，我认为就不难做到，剩下的就是实现细节和性能的考量了。</p>
<h2 id="PINDiskCache"><a href="#PINDiskCache" class="headerlink" title="PINDiskCache"></a>PINDiskCache</h2><p><code>PINDiskCache</code>实现的磁盘缓存。我们知道，磁盘的读取速度要远小于内存读取。大量的磁盘I/O会降低程序的运行效率。虽然如此，面对大体量的数据以及需要长期存储的数据，我们只能考虑存储在磁盘上。同时，由于iOS系统的特殊性，选择存储在磁盘上往往是我们的第一选择。</p>
<p>和<code>memory cache</code>不同，磁盘I/O需要考虑的问题要更多一点，除了上面再<code>memory cache</code>讲到的几点外，还需要考虑一下几点。</p>
<ol>
<li>实现方式。磁盘存储一般分为三种：文件读写，数据库，mmap文件内存映射。<code>PINDiskCache</code>使用的是文件读写的方式</li>
<li>存储位置。iOS文件系统不同位置建议存储的内容不同。是放在cache文件夹中还是temp文件中取决于开发者对存储文件的态度。</li>
<li>文件系统的细节。避免和其他文件产生冲突，必须考虑拥有自身的标记。</li>
<li>数据序列化</li>
</ol>
<p>看上去磁盘缓存的实现的确要难上很多问题，在内存缓存的基础上依然要考虑这么多问题。</p>
<p><code>PINDiskCache</code>在这四个问题上，充分考虑了oc语言已经iOS已经MAC OS系统的特性。首先采用文件读写的方式，依然考虑了数据的特性。文件读写的方式非常适合用于存储数据规模小的情况，同时实现方便，性能稳定也是选择的原因之一。但是使用文件存储也有不小的弱点：方便扩展、没有元数据、难以实现较好的淘汰算法、数据统计缓慢。</p>
<p>2，3，4点将在下面实现细节中会讲到。</p>
<h3 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h3><h4 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h4><p>线程安全依然是绕不过去的一个坎，在<code>PINDiskCache</code>里，除了需要对付一般的<strong>data race</strong>，还需要处理磁盘I/O带来的问题。</p>
<p>在这里，<code>PINDiskCache</code>使用的是<code>NSConditionLock</code>条件锁。在代码中有如下定义：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, PINDiskCacheCondition) &#123;</span><br><span class="line">    PINDiskCacheConditionNotReady = <span class="number">0</span>,</span><br><span class="line">    PINDiskCacheConditionReady = <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可见，条件锁中并不涉及到具体的实例对象，而是一个常量来作为锁的条件。在这里，个人认为直接用递归锁差别也不是很大，不知道为何这里选择使用了条件锁。（或许有一天知道了会回来补。</p>
<p>在使用中，所有对成员变量操作的地方都进行的锁操作。(实际上有些地方是不需要用的)</p>
<h3 id="读写"><a href="#读写" class="headerlink" title="读写"></a>读写</h3><p>磁盘读写如果不注意极其容易造成死锁。</p>
<p>写：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span> &lt;<span class="built_in">NSCoding</span>&gt;)object forKey:(<span class="built_in">NSString</span> *)key fileURL:(<span class="built_in">NSURL</span> **)outFileURL</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!key || !object)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#if TARGET_OS_IPHONE</span></span><br><span class="line">      <span class="built_in">NSDataWritingOptions</span> writeOptions = <span class="built_in">NSDataWritingAtomic</span> | <span class="keyword">self</span>.writingProtectionOption;</span><br><span class="line">    <span class="meta">#else</span></span><br><span class="line">      <span class="built_in">NSDataWritingOptions</span> writeOptions = <span class="built_in">NSDataWritingAtomic</span>;</span><br><span class="line">    <span class="meta">#endif</span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">NSURL</span> *fileURL = [<span class="keyword">self</span> encodedFileURLForKey:key];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">        PINDiskCacheObjectBlock willAddObjectBlock = <span class="keyword">self</span>-&gt;_willAddObjectBlock;</span><br><span class="line">        <span class="keyword">if</span> (willAddObjectBlock) &#123;</span><br><span class="line">            [<span class="keyword">self</span> unlock];</span><br><span class="line">                willAddObjectBlock(<span class="keyword">self</span>, key, object);</span><br><span class="line">            [<span class="keyword">self</span> lock];</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//We unlock here so that we're not locked while serializing.</span></span><br><span class="line">        [<span class="keyword">self</span> unlock];</span><br><span class="line">            <span class="built_in">NSData</span> *data = _serializer(object, key);</span><br><span class="line">        [<span class="keyword">self</span> lock];</span><br><span class="line">    </span><br><span class="line">        <span class="built_in">NSError</span> *writeError = <span class="literal">nil</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="built_in">BOOL</span> written = [data writeToURL:fileURL options:writeOptions error:&amp;writeError];</span><br><span class="line">        PINDiskCacheError(writeError);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (written) &#123;</span><br><span class="line">            <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">            <span class="built_in">NSDictionary</span> *values = [fileURL resourceValuesForKeys:@[ <span class="built_in">NSURLContentModificationDateKey</span>, <span class="built_in">NSURLTotalFileAllocatedSizeKey</span> ] error:&amp;error];</span><br><span class="line">            PINDiskCacheError(error);</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">NSNumber</span> *diskFileSize = [values objectForKey:<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">            <span class="keyword">if</span> (diskFileSize) &#123;</span><br><span class="line">                <span class="built_in">NSNumber</span> *prevDiskFileSize = [<span class="keyword">self</span>-&gt;_sizes objectForKey:key];</span><br><span class="line">                <span class="keyword">if</span> (prevDiskFileSize) &#123;</span><br><span class="line">                    <span class="keyword">self</span>.byteCount = <span class="keyword">self</span>-&gt;_byteCount - [prevDiskFileSize unsignedIntegerValue];</span><br><span class="line">                &#125;</span><br><span class="line">                [<span class="keyword">self</span>-&gt;_sizes setObject:diskFileSize forKey:key];</span><br><span class="line">                <span class="keyword">self</span>.byteCount = <span class="keyword">self</span>-&gt;_byteCount + [diskFileSize unsignedIntegerValue]; <span class="comment">// atomic</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">NSDate</span> *date = [values objectForKey:<span class="built_in">NSURLContentModificationDateKey</span>];</span><br><span class="line">            <span class="keyword">if</span> (date) &#123;</span><br><span class="line">                [<span class="keyword">self</span>-&gt;_dates setObject:date forKey:key];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>-&gt;_byteLimit &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">self</span>-&gt;_byteCount &gt; <span class="keyword">self</span>-&gt;_byteLimit)</span><br><span class="line">                [<span class="keyword">self</span> trimToSizeByDate:<span class="keyword">self</span>-&gt;_byteLimit block:<span class="literal">nil</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fileURL = <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        PINDiskCacheObjectBlock didAddObjectBlock = <span class="keyword">self</span>-&gt;_didAddObjectBlock;</span><br><span class="line">        <span class="keyword">if</span> (didAddObjectBlock) &#123;</span><br><span class="line">            [<span class="keyword">self</span> unlock];</span><br><span class="line">                didAddObjectBlock(<span class="keyword">self</span>, key, object);</span><br><span class="line">            [<span class="keyword">self</span> lock];</span><br><span class="line">        &#125;</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (outFileURL) &#123;</span><br><span class="line">        *outFileURL = fileURL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>读：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">- (__<span class="keyword">nullable</span> <span class="keyword">id</span> &lt;<span class="built_in">NSCoding</span>&gt;)objectForKey:(<span class="built_in">NSString</span> *)key fileURL:(<span class="built_in">NSURL</span> **)outFileURL</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSDate</span> *now = [[<span class="built_in">NSDate</span> alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">id</span> &lt;<span class="built_in">NSCoding</span>&gt; object = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSURL</span> *fileURL = [<span class="keyword">self</span> encodedFileURLForKey:key];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>-&gt;_ttlCache || <span class="keyword">self</span>-&gt;_ageLimit &lt;= <span class="number">0</span> || fabs([[_dates objectForKey:key] timeIntervalSinceDate:now]) &lt; <span class="keyword">self</span>-&gt;_ageLimit) &#123;</span><br><span class="line">            <span class="comment">// If the cache should behave like a TTL cache, then only fetch the object if there's a valid ageLimit and  the object is still alive</span></span><br><span class="line">            <span class="built_in">NSData</span> *objectData = [[<span class="built_in">NSData</span> alloc] initWithContentsOfFile:[fileURL path]];</span><br><span class="line">          </span><br><span class="line">            <span class="keyword">if</span> (objectData) &#123;</span><br><span class="line">              <span class="comment">//Be careful with locking below. We unlock here so that we're not locked while deserializing, we re-lock after.</span></span><br><span class="line">              [<span class="keyword">self</span> unlock];</span><br><span class="line">              <span class="keyword">@try</span> &#123;</span><br><span class="line">                  object = _deserializer(objectData, key);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">                  <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">                  [<span class="keyword">self</span> lock];</span><br><span class="line">                      [[<span class="built_in">NSFileManager</span> defaultManager] removeItemAtPath:[fileURL path] error:&amp;error];</span><br><span class="line">                  [<span class="keyword">self</span> unlock];</span><br><span class="line">                  PINDiskCacheError(error);</span><br><span class="line">              &#125;</span><br><span class="line">              [<span class="keyword">self</span> lock];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (object &amp;&amp; !<span class="keyword">self</span>-&gt;_ttlCache) &#123;</span><br><span class="line">                [<span class="keyword">self</span> asynchronouslySetFileModificationDate:now forURL:fileURL];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (outFileURL) &#123;</span><br><span class="line">        *outFileURL = fileURL;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 在序列化和反序列化的地方解锁，之后再上锁，目的是避免死锁问题(序列化失败等)。</p>
<p> 在读写之后，改变文件的最后修改时间，作为一个参考依据。</p>
<p> 在写入的时候，先尝试将数据写入到磁盘，然后读取写入的文件的信息，比较文件的大小是否和写入的数据大小相同</p>
<h3 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h3><p>在<code>PINDiskCache</code>中大量使用了异步操作。比如读取文件后修改文件时间：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)asynchronouslySetFileModificationDate:(<span class="built_in">NSDate</span> *)date forURL:(<span class="built_in">NSURL</span> *)fileURL</span><br><span class="line">&#123;</span><br><span class="line">    __<span class="keyword">weak</span> PINDiskCache *weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.operationQueue addOperation:^&#123;</span><br><span class="line">        PINDiskCache *strongSelf = weakSelf;</span><br><span class="line">        <span class="keyword">if</span> (strongSelf) &#123;</span><br><span class="line">            [strongSelf lock];</span><br><span class="line">                [strongSelf _locked_setFileModificationDate:date forURL:fileURL];</span><br><span class="line">            [strongSelf unlock];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; withPriority:PINOperationQueuePriorityLow];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用的<code>operationQueue</code>就是在下面要讲到<code>PINCache</code>自己实现的一套异步方案</p>
<h3 id="淘汰方法"><a href="#淘汰方法" class="headerlink" title="淘汰方法"></a>淘汰方法</h3><p><code>PINDiskCache</code>仍然根据文件大小和最近修改时间来作为淘汰的依据。</p>
<h2 id="PINOperationQueue"><a href="#PINOperationQueue" class="headerlink" title="PINOperationQueue"></a>PINOperationQueue</h2><p><code>PINOperationQueue</code>是<code>PINCache</code>实现的一个并发控制方案。实现了最大并发数，取消，优先级管理。在<code>PINDiskCache</code>中大量使用了<code>PINOperationQueue</code>来达到并发行为的控制。</p>
<h3 id="实现细节-1"><a href="#实现细节-1" class="headerlink" title="实现细节"></a>实现细节</h3><p><code>PINOperationQueue</code>是对外公开的操作，主要是通过下面方法添加操作</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span> &lt;PINOperationReference&gt;)addOperation:(PINOperationBlock)operation</span><br><span class="line">                              withPriority:(PINOperationQueuePriority)priority</span><br><span class="line">                                identifier:(<span class="built_in">NSString</span> *)identifier</span><br><span class="line">                            coalescingData:(<span class="keyword">nullable</span> <span class="keyword">id</span>)coalescingData</span><br><span class="line">                      dataCoallescingBlock:(<span class="keyword">nullable</span> PINOperationDataCoallescingBlock)dataCoallescingBlock</span><br><span class="line">                                completion:(<span class="keyword">nullable</span> dispatch_block_t)completion;</span><br></pre></td></tr></table></figure>
<p>其中<code>dataCoallescingBlock</code>和<code>coalescingData</code>提供了联合数据处理的能力，例如</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)trimToDate:(<span class="built_in">NSDate</span> *)trimDate block:(PINDiskCacheBlock)block</span><br><span class="line">&#123;</span><br><span class="line">    PINOperationBlock operation = ^(<span class="keyword">id</span> data)&#123;</span><br><span class="line">        [<span class="keyword">self</span> trimToDate:(<span class="built_in">NSDate</span> *)data];</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    dispatch_block_t completion = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (block) &#123;</span><br><span class="line">        completion = ^&#123;</span><br><span class="line">            block(<span class="keyword">self</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.operationQueue addOperation:operation</span><br><span class="line">                         withPriority:PINOperationQueuePriorityLow</span><br><span class="line">                           identifier:PINDiskCacheOperationIdentifierTrimToDate</span><br><span class="line">                       coalescingData:trimDate</span><br><span class="line">                  dataCoallescingBlock:PINDiskTrimmingDateCoallescingBlock</span><br><span class="line">                           completion:completion];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法中，<code>DiskCache</code>会去清除指定时间的数据，在这里，添加到<code>PINOperationQueue</code>的时候，将<code>trimDate</code>作为联合数据传入。这里的联合数据，可以认为是block之外的一个负载。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>通过初始化可以得知，<code>PINOperationQueue</code>是怎么实现上述功能的。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pthread_mutex_t _lock;</span><br><span class="line"> <span class="comment">//increments with every operation to allow cancelation</span></span><br><span class="line"> <span class="built_in">NSUInteger</span> _operationReferenceCount;</span><br><span class="line"> <span class="built_in">NSUInteger</span> _maxConcurrentOperations;</span><br><span class="line"> </span><br><span class="line"> dispatch_group_t _group;</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">dispatch_queue_t</span> _serialQueue;</span><br><span class="line"> <span class="built_in">BOOL</span> _serialQueueBusy;</span><br><span class="line"> </span><br><span class="line"> dispatch_semaphore_t _concurrentSemaphore;</span><br><span class="line"> <span class="built_in">dispatch_queue_t</span> _concurrentQueue;</span><br><span class="line"> <span class="built_in">dispatch_queue_t</span> _semaphoreQueue;</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">NSMutableOrderedSet</span>&lt;PINOperation *&gt; *_queuedOperations;</span><br><span class="line"> <span class="built_in">NSMutableOrderedSet</span>&lt;PINOperation *&gt; *_lowPriorityOperations;</span><br><span class="line"> <span class="built_in">NSMutableOrderedSet</span>&lt;PINOperation *&gt; *_defaultPriorityOperations;</span><br><span class="line"> <span class="built_in">NSMutableOrderedSet</span>&lt;PINOperation *&gt; *_highPriorityOperations;</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">NSMapTable</span>&lt;<span class="keyword">id</span>&lt;PINOperationReference&gt;, PINOperation *&gt; *_referenceToOperations;</span><br><span class="line"> <span class="built_in">NSMapTable</span>&lt;<span class="built_in">NSString</span> *, PINOperation *&gt; *_identifierToOperations;</span><br></pre></td></tr></table></figure>
<p>通过<code>PINOperationQueue</code>的成员变量，可以得知：</p>
<ol>
<li>通过<code>dispatch_semaphore_t</code>来实现并发数控制。<code>dispatch_semaphore_t</code>是信号量</li>
<li>通过<code>NSMutableOrderedSet</code>实现了优先级和顺序管理。<code>NSMutableOrderedSet</code>是具有排序功能的集合类。</li>
<li>通过<code>NSMapTable</code>实现了绑定id和操作。<code>NSMapTable</code>类似<code>NSdictionry</code>，区别在于<code>NSMapTable</code>是可变的，同时键值可以为弱引用，当任何一项为nil的时候将这一项移除。同时，<code>NSMapTable</code>可以存储任意指针，通过指针来进行相等性和散列校验</li>
</ol>
<p>初始化代码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithMaxConcurrentOperations:(<span class="built_in">NSUInteger</span>)maxConcurrentOperations concurrentQueue:(<span class="built_in">dispatch_queue_t</span>)concurrentQueue</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">    <span class="built_in">NSAssert</span>(maxConcurrentOperations &gt; <span class="number">1</span>, <span class="string">@"Max concurrent operations must be greater than 1. If it's one, just use a serial queue!"</span>);</span><br><span class="line">    _maxConcurrentOperations = maxConcurrentOperations;</span><br><span class="line">    _operationReferenceCount = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    pthread_mutexattr_t attr;</span><br><span class="line">    pthread_mutexattr_init(&amp;attr);</span><br><span class="line">    <span class="comment">//mutex must be recursive to allow scheduling of operations from within operations</span></span><br><span class="line">    pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE);</span><br><span class="line">    pthread_mutex_init(&amp;_lock, &amp;attr);</span><br><span class="line">    </span><br><span class="line">    _group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    _serialQueue = dispatch_queue_create(<span class="string">"PINOperationQueue Serial Queue"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    _concurrentQueue = concurrentQueue;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Create a queue with max - 1 because this plus the serial queue add up to max.</span></span><br><span class="line">    _concurrentSemaphore = dispatch_semaphore_create(_maxConcurrentOperations - <span class="number">1</span>);</span><br><span class="line">    _semaphoreQueue = dispatch_queue_create(<span class="string">"PINOperationQueue Serial Semaphore Queue"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    _queuedOperations = [[<span class="built_in">NSMutableOrderedSet</span> alloc] init];</span><br><span class="line">    _lowPriorityOperations = [[<span class="built_in">NSMutableOrderedSet</span> alloc] init];</span><br><span class="line">    _defaultPriorityOperations = [[<span class="built_in">NSMutableOrderedSet</span> alloc] init];</span><br><span class="line">    _highPriorityOperations = [[<span class="built_in">NSMutableOrderedSet</span> alloc] init];</span><br><span class="line">    </span><br><span class="line">    _referenceToOperations = [<span class="built_in">NSMapTable</span> weakToWeakObjectsMapTable];</span><br><span class="line">    _identifierToOperations = [<span class="built_in">NSMapTable</span> weakToWeakObjectsMapTable];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，实现了一个递归锁。递归锁允许在未释放锁的时候反复的上锁，当解锁次数和等于上锁的次数的时候才<code>PINOperationQueue</code>可能在一个多次加锁。</p>
<h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><p><code>PINOperationQueue</code>最大特色就是实现了并发管理操作，提供cancel，wait, Priority的功能，通过实现来看看怎么做到的。</p>
<p><code>- (void)scheduleNextOperations:(BOOL)onlyCheckSerial</code>方法为派发operation的地方私有方法。</p>
<p><code>scheduleNextOperations</code>执行的分为两块</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> lock];</span><br><span class="line">  <span class="comment">//get next available operation in order, ignoring priority and run it on the serial queue</span></span><br><span class="line">  <span class="keyword">if</span> (_serialQueueBusy == <span class="literal">NO</span>) &#123;</span><br><span class="line">    PINOperation *operation = [<span class="keyword">self</span> locked_nextOperationByQueue];</span><br><span class="line">    <span class="keyword">if</span> (operation) &#123;</span><br><span class="line">      _serialQueueBusy = <span class="literal">YES</span>;</span><br><span class="line">      <span class="built_in">dispatch_async</span>(_serialQueue, ^&#123;</span><br><span class="line">        operation.block(operation.data);</span><br><span class="line">        <span class="keyword">for</span> (dispatch_block_t completion <span class="keyword">in</span> operation.completions) &#123;</span><br><span class="line">          completion();</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(_group);</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> lock];</span><br><span class="line">          _serialQueueBusy = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span> unlock];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//see if there are any other operations</span></span><br><span class="line">        [<span class="keyword">self</span> scheduleNextOperations:<span class="literal">YES</span>];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">[<span class="keyword">self</span> unlock];</span><br></pre></td></tr></table></figure>
<p>在这里，<code>locked_nextOperationByQueue</code>从<code>_queuedOperations</code>取出第一个operation，然后异步派发到<code>_serialQueue</code>中执行。可以看出，这里本质是串行取出operation然后再派发到<code>_serialQueue</code>异步执行。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(_semaphoreQueue, ^&#123;</span><br><span class="line">    dispatch_semaphore_wait(_concurrentSemaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    [<span class="keyword">self</span> lock];</span><br><span class="line">      PINOperation *operation = [<span class="keyword">self</span> locked_nextOperationByPriority];</span><br><span class="line">    [<span class="keyword">self</span> unlock];</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (operation) &#123;</span><br><span class="line">      <span class="built_in">dispatch_async</span>(_concurrentQueue, ^&#123;</span><br><span class="line">        operation.block(operation.data);</span><br><span class="line">        <span class="keyword">for</span> (dispatch_block_t completion <span class="keyword">in</span> operation.completions) &#123;</span><br><span class="line">          completion();</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(_group);</span><br><span class="line">        dispatch_semaphore_signal(_concurrentSemaphore);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dispatch_semaphore_signal(_concurrentSemaphore);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在这里，实现了并发，从<code>locked_nextOperationByPriority</code>方法中根据优先级获得一个operation，异步派发到<code>_concurrentQueue</code>中执行。这里通过信号量来管理并发数，当信号量为0的时候就会一直等待。</p>
<p><code>locked_nextOperationByPriority</code>中从<code>_highPriorityOperations</code>取，取不到的情况下就从下一个优先级的set中取。</p>
<p>看懂了<code>scheduleNextOperations</code>，再看<code>locked_cancelOperation</code>就不难了。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)locked_cancelOperation:(<span class="keyword">id</span> &lt;PINOperationReference&gt;)operationReference</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">BOOL</span> success = <span class="literal">NO</span>;</span><br><span class="line">  PINOperation *operation = [_referenceToOperations objectForKey:operationReference];</span><br><span class="line">  <span class="keyword">if</span> (operation) &#123;</span><br><span class="line">    <span class="built_in">NSMutableOrderedSet</span> *queue = [<span class="keyword">self</span> operationQueueWithPriority:operation.priority];</span><br><span class="line">    <span class="keyword">if</span> ([queue containsObject:operation]) &#123;</span><br><span class="line">      success = <span class="literal">YES</span>;</span><br><span class="line">      [queue removeObject:operation];</span><br><span class="line">      [_queuedOperations removeObject:operation];</span><br><span class="line">      dispatch_group_leave(_group);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> success;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取消操作，主要根据operationRef来取出操作，然后从所在的优先级队列中删除对应的operation。注意到，如果这个operation已经被派发到执行队列上了，就无法取消了。</p>
<p><code>PINOperationGroup</code>是在<code>PINOperationQueue</code>之上再实现的包装。</p>
<p><code>PINOperationQueue</code>和<code>PINOperationGroup</code>可以看做是<code>PINCache</code>使用的GCD实现一套与NSOperation相似的功能。通过学习阅读这一块，可以加深对GCD异步处理的理解。</p>
<h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p><code>PINCache</code>是这个系列的第二篇，个人感觉收获很大，对整个key-value缓存实现的一个思路有了更清楚的认识。</p>
<p>下一篇，打算看看<code>YYCache</code>,主要关注点是如何实现缓存淘汰算法和优化性能的。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/01/10/2017-01-10-持久化学习系列2/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-2017-01-08-持久化学习系列1" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/08/2017-01-08-持久化学习系列1/">持久化学习系列1</a>
    </h1>
  

        
        <a href="/2017/01/08/2017-01-08-持久化学习系列1/" class="archive-article-date">
  	<time datetime="2017-01-08T08:16:57.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-01-08</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>SPTPersistentCache</code>是<strong>spotify</strong>开源的一套持久化框架。<code>SPTPersistentCache</code>主要解决<code>NSData</code>存储到文件系统的过程。</p>
<h2 id="亮点"><a href="#亮点" class="headerlink" title="亮点"></a>亮点</h2><ul>
<li>基于LRU</li>
<li>线程安全</li>
<li>可视化工具</li>
<li>类HTTP设计</li>
</ul>
<h2 id="成员分析"><a href="#成员分析" class="headerlink" title="成员分析"></a>成员分析</h2><p>先从Public Api来进行分析</p>
<p><img src="../media/14824843501540.jpg" alt=""></p>
<p><code>SPTPersistentCache</code>是核心，同比为manager的角色。<br><code>SPTPersistentCacheOptions</code>是配置选项，<br><code>SPTPersistentCacheHeader</code>是<code>SPTPersistentCache</code>的一大设计的特色，数据表头<br><code>SPTPersistentCacheRecord</code>为数据单元。<br><code>SPTPersistentCacheResponse</code>为操纵数据的基本单位。</p>
<p>这次分析打算从下往上，先从基本的数据单元开始</p>
<h3 id="SPTPersistentCacheRecord"><a href="#SPTPersistentCacheRecord" class="headerlink" title="SPTPersistentCacheRecord"></a>SPTPersistentCacheRecord</h3><p><code>SPTPersistentCacheRecord</code>中除了data之外还定义三个辅助数据</p>
<ul>
<li>refCount 引用计数</li>
<li>ttl 生存时间</li>
<li>key </li>
</ul>
<p>可以从<code>SPTPersistentCacheRecord</code>看出<code>SPTPersistent</code>依照引用次数和时间来管理缓存对象</p>
<h3 id="SPTPersistentCacheResponse"><a href="#SPTPersistentCacheResponse" class="headerlink" title="SPTPersistentCacheResponse"></a>SPTPersistentCacheResponse</h3><p><code>SPTPersistentCacheResponse</code>是对<code>SPTPersistentCacheRecord</code>的再一层包装。新增了对外属性</p>
<ul>
<li>SPTPersistentCacheResponseCode</li>
<li>NSError</li>
</ul>
<p>从<code>SPTPersistentCacheResponseCode</code>可以看出这一层与读写操作相关了。</p>
<h3 id="SPTPersistentCacheRecord-1"><a href="#SPTPersistentCacheRecord-1" class="headerlink" title="SPTPersistentCacheRecord"></a>SPTPersistentCacheRecord</h3><p><code>SPTPersistentCacheRecord</code>并不是一个类，而是一个结构体。在这里，可以将<code>SPTPersistentCacheRecord</code>与HTTP中的<code>header</code>进行类比。</p>
<p>关键点：crc，flags</p>
<p>crc：<strong>循环冗余校验</strong> 在数据写入前通过计算生成32位整数，拼接在数据后面。在读取的时候进行校验，确认数据是否完整。<code>SPTPersistentCache</code>使用的是<code>CRC-64-ISO</code></p>
<p>flags: 判断数据是否在上次写入的时候没能完成。这个更多是逻辑而不是一个错误。</p>
<h3 id="SPTPersistentCacheOptions"><a href="#SPTPersistentCacheOptions" class="headerlink" title="SPTPersistentCacheOptions"></a>SPTPersistentCacheOptions</h3><p><code>SPTPersistentCacheOptions</code>是cache的配置相关的内容。从配置中够可以看出<code>SPTPersistentCache</code>的一些特性</p>
<p><code>identifierForQueue</code>作为唯一队列标识，可以预知每一个cache拥有唯一的队列</p>
<p><code>cacheIdentifier</code>作为配置对应的cache唯一标识</p>
<p>优先级设定中分别定义了并发操作数，读写删的优先级</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> maxConcurrentOperations;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSOperationQueuePriority</span> writePriority;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSOperationQueuePriority</span> readPriority;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSOperationQueuePriority</span> deletePriority;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSQualityOfService</span> writeQualityOfService;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSQualityOfService</span> readQualityOfService;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSQualityOfService</span> deleteQualityOfService;</span><br></pre></td></tr></table></figure>
<p>GC设定中对GC的配置进行设定</p>
<p><code>garbageCollectionInterval</code>决定了GC的间隔</p>
<p><code>defaultExpirationPeriod</code> 决定默认过期时间</p>
<p><code>sizeConstraintBytes</code> 设定了缓存空间的限制</p>
<p><code>garbageCollectionPriority</code>设定GC操作的优先级</p>
<p><code>garbageCollectionQualityOfService</code>设定GC服务的QOS</p>
<p>从option中可以窥探出，在开发过程中可能会有多个cache，每个cache之间的配置独立，拥有独立的优先级和GC管理</p>
<h3 id="SPTPersistentCache"><a href="#SPTPersistentCache" class="headerlink" title="SPTPersistentCache"></a>SPTPersistentCache</h3><p><code>SPTPersistentCache</code>是整个持久化库的核心类，包含了读，写，查，删，锁等操作</p>
<p>读操作中，对外公开的两个API最后会归集到下面这个方法中</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)loadDataForKeySync:(<span class="built_in">NSString</span> *)key</span><br><span class="line">              withCallback:(SPTPersistentCacheResponseCallback)callback</span><br><span class="line">                   onQueue:(<span class="built_in">dispatch_queue_t</span>)queue</span><br></pre></td></tr></table></figure>
<p>方法并不是很复杂，具体的流程简单描述如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">首先，根据key去查找是否有对应的文件，木有的话就抛错 (1)</span><br><span class="line"></span><br><span class="line">如果找到了文件，读取data，如果读取失败，认为文件损坏了，抛错(2)</span><br><span class="line"></span><br><span class="line">从文件中读出了数据，根据headerSize取出head。如果不能正确的拼装出header，即认为此文件无法继续操作，抛错(3)</span><br><span class="line"></span><br><span class="line">拼装了header后，进行校验，校验不通过，抛错(4)</span><br><span class="line"></span><br><span class="line">与本地header做比较，如果不一致，抛错(5)</span><br><span class="line"></span><br><span class="line">将读出的payload(负载数据)组装成`SPTPersistentCacheRecord`，再将`SPTPersistentCacheRecord`组装成`SPTPersistentCacheResponse`</span><br><span class="line"></span><br><span class="line">将访问数据相关写回磁盘</span><br><span class="line"></span><br><span class="line">将response通过block回调给开发者。</span><br></pre></td></tr></table></figure>
<p>可以看到，总共有5步抛错的地方，都是对数据完整性的校验。</p>
<p>相对于读，写的难度就小了很多，不太复杂。写方法主要是在</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSError</span> *)storeDataSync:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                    forKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">                       ttl:(<span class="built_in">NSUInteger</span>)ttl</span><br><span class="line">                    locked:(<span class="built_in">BOOL</span>)isLocked</span><br><span class="line">              withCallback:(SPTPersistentCacheResponseCallback)callback</span><br><span class="line">                   onQueue:(<span class="built_in">dispatch_queue_t</span>)queue</span><br></pre></td></tr></table></figure>
<p>将Header与data拼装后组成rowData，然后写入磁盘，注意判断是否写入成功。之后通过block将response回调给开发者</p>
<h2 id="GC和LRU实现"><a href="#GC和LRU实现" class="headerlink" title="GC和LRU实现"></a>GC和LRU实现</h2><p><strong>LRU是Least Recently Used 近期最少使用算法。</strong></p>
<p>在最近的面试中，经常会谈到一些缓存库的实现，比如最常见的<code>SDWebImageCache</code>。对此我常会提出一个疑问，如何设计高效的缓存。几乎没人能够谈谈缓存调度算法。LRU其实就是最常用的一种缓存调度算法，目的就是尽力保证缓存中的数据是常用的。</p>
<p>这里谈谈<code>SPTPersistentCache</code>中是如何实现GC和LRU算法的。</p>
<p>在上文<code>SPTPersistentCacheRecord</code>的简介中，我们看到了两个关键的属性：TTL &amp;&amp; refcount。我们可以猜测到，<code>SPTPersistentCache</code>是通过实践和引用值来判断是数据的有效性的。</p>
<p>GC的核心是👇这个方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)collectGarbageForceExpire:(<span class="built_in">BOOL</span>)forceExpire forceLocked:(<span class="built_in">BOOL</span>)forceLocked</span><br></pre></td></tr></table></figure>
<p>传参分别是强制过期和强制加锁。</p>
<p>过程不复杂，通过<code>NSDirectoryEnumerator</code>迭代器从<code>self.fileManager</code>中取出所有文件。</p>
<p>判断是否过期是通过下面这个方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (SPTPersistentCacheResponse *)alterHeaderForFileAtPath:(<span class="built_in">NSString</span> *)filePath</span><br><span class="line">                                               withBlock:(SPTPersistentCacheRecordHeaderGetCallbackType)modifyBlock</span><br><span class="line">                                               writeBack:(<span class="built_in">BOOL</span>)needWriteBack</span><br><span class="line">                                                complain:(<span class="built_in">BOOL</span>)needComplains</span><br></pre></td></tr></table></figure>
<p>这个方法是唯一去访问文件header的方法。</p>
<p>传入<code>modifyBlock</code>将改变header。</p>
<p>回到GC的过程中，可以看到通过传入<code>modifyBlock</code>来获取header。在<code>modifyBlock</code>中，通过header中的refcount来判断是否需要移除。</p>
<p>那么什么情况会触发<code>refcount</code>的变化呢？</p>
<p>在<code>lockDataForKeys</code>方法中，可以看到这样一行代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// Satisfy Req.#1.2</span></span><br><span class="line"> <span class="keyword">if</span> ([<span class="keyword">self</span> isDataExpiredWithHeader:header]) &#123;</span><br><span class="line"> expired = <span class="literal">YES</span>;</span><br><span class="line"> <span class="keyword">return</span>;                                                                        &#125;</span><br><span class="line">++header-&gt;refCount;</span><br><span class="line"><span class="comment">// Do not update access time since file is locked</span></span><br></pre></td></tr></table></figure>
<p>可知，当执行lock的时候，如果数据本身没过期，会使引用计数+1。</p>
<p>同理，当unlock的时候，会使引用计数-1。</p>
<p>可见，refcount只有1和0两个值。</p>
<p>而<code>TTL（存活时间）</code>则是数据的的生命周期。如果没有<code>forceExpire</code>和<code>forceLocked</code>的话，则当<code>[self isDataExpiredWithHeader:header] &amp;&amp; header-&gt;refCount == 0</code>的时候删除数据。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>github上实现二进制缓存的cache库不多，<code>SPTPersistentCache</code>是其中的佼佼者。原因在于<strong>spotify</strong>本身做在线音乐服务，在二进制缓存上有比较强的需求。</p>
<p><code>SPTPersistentCache</code>的实现我认为参考了HTTP协议，通过一个Header来为数据添加metedata，同时实现了GC。可以<code>SPTPersistentCache</code>的实现方式非常值得学习，在阅读<code>SPTPersistentCache</code>的过程中学习了不少二进制文件操作的方法，收益良多，也为这个系列开了一个好头。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">iOS</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/01/08/2017-01-08-持久化学习系列1/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-2016-12-31-2016，注定不平凡" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/31/2016-12-31-2016，注定不平凡/">2016，注定不平凡</a>
    </h1>
  

        
        <a href="/2016/12/31/2016-12-31-2016，注定不平凡/" class="archive-article-date">
  	<time datetime="2016-12-31T01:50:41.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2016年，注定是一个不一样的年份。年头到年尾，世界上发生了太多历史性的进程。一个英国脱欧，一个特朗普当选就足以让世人谈论上许多年。对于我个人，也是一个不同寻常的年份：今年我毕业了。</p>
<h3 id="毕业了，我想谈谈教育"><a href="#毕业了，我想谈谈教育" class="headerlink" title="毕业了，我想谈谈教育"></a>毕业了，我想谈谈教育</h3><p>从上学第一天开始，我就想什么时候会结束这一段历程，想不到到来后却一点感觉没有。结束了学生身份，最大的感触就是：不再会有人照顾你了。</p>
<p>16年的求学经历，改变了一个人多少，每个人都会有自己的看法。在我看来，学生时代养成的习惯是永远改不掉的。很幸运的是，自己能够从小学一路顺利得读完大学。相比较许多无缘能够进入学校学习的人来说，能够接受完整系统的知识教育，是一件太幸福的事情。</p>
<p>在经历了完整的中国教育系统设计的教育体系后，感觉并没有网络以及他人所说的那么不堪。的确，中国某些体系原因造成了教育系统多变的情况，我也是几乎踏准了每次教育改革的门槛。但是我并不认为，这些改革最后改变了什么，甚至我不认为教授的内容会对人有什么影响。到目前为止，我认为，学校教育带给我最大的好处，就是学会系统逻辑的思考以及自学能力。</p>
<p>大多人批判中国教育为填鸭式教育。其实，在我看来，这只是一种迫不得已的手段。只有在严酷的训练下，才有悟的可能。绝不同于网络小说的主人公，我们不会在一天突然灵光一闪然后打通了任督二脉因此学贯中西。我们只能在不停地残酷的训练中总结，直到有一天明白知识的相通性。很遗憾的是，太多人麻木在重复高强度的训练中，只有少数人能够参透。我也是在大学最后，才明白过来，为时已晚。</p>
<p>教育，最大的目的是授人以渔。学会学习才是学习最大的目的。</p>
<h3 id="读书，不是为了考试"><a href="#读书，不是为了考试" class="headerlink" title="读书，不是为了考试"></a>读书，不是为了考试</h3><p>上了大学后，除了少数的专业书籍，几乎怎么看书了。就这样浑浑噩噩过了两年，不仅专业并没有多大的提升，眼界和思维也是停滞不前。所幸的是这两年又捡回了读书的习惯。如果只依靠考试来鞭笞自己读书，恐怕也无法在未来走的更远吧。</p>
<p>在这里简单列下书单，也算推荐一些书籍</p>
<ul>
<li><a href="https://book.douban.com/subject/3369600/" target="_blank" rel="noopener">当我谈跑步时我谈些什么</a> 春上春树记录自己的跑步中一些随想。看到其中一些想法和自己跑步中想法有相似之处。</li>
<li><a href="https://book.douban.com/subject/26835090/" target="_blank" rel="noopener">Soft Skills: The software developer’s life manual</a>代码之外的软技能。程序员不能只埋头技术，还应该抬头看看世界。</li>
<li><a href="https://book.douban.com/subject/3432304/" target="_blank" rel="noopener">大江东去</a>讲改革开放前期的小说。前两部给我的启发很多。</li>
<li><a href="https://book.douban.com/subject/4239246/" target="_blank" rel="noopener">市场的力量</a>有点浅，实例不错。</li>
<li><a href="https://book.douban.com/subject/7057936/" target="_blank" rel="noopener">批判性思维：带你走出思维误区</a>中文翻译有些无法表达完善，但内容的确详实，有能力的推荐看原版</li>
<li><a href="https://book.douban.com/subject/5290524/" target="_blank" rel="noopener">微革命</a>内容偏水，思考的点不错。</li>
</ul>
<p>16年因为毕业，没能完成自己在年初定下的读书计划。17年不该再有借口。读书，应该是一辈子的事情。</p>
<h3 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h3><p>作为程序员，年终总结怎么能不写技术呢？不过，我不打算在这里写很多技术内容，只想谈谈对编程技术的一些思考。</p>
<p>编程技术，总的来说我认为也属于工程技术的一种，而且是属于门槛较低的部分。君不见满街40天培训Android，iOS，web月薪过万。然而，只有潮退了才知道谁在裸泳。16年的资本寒冬也影响到了炙手可热的互联网产业。一批批创业公司倒下使初级开发严重过剩。一个iOS岗位一周几百上千封简历不是夸张。作为一名刚毕业进入工作岗位的开发，说没有担心那是假的。究竟在几年后如何保持一定的竞争力？这些个一直在思考这些问题。</p>
<p>广义上的信息技术发展已经有几十个年头了，而新概念还在层出不穷。机器学习，AR,VR,大数据等等名字容易让新进行业的人头晕眼花。不能不承认，APP时代已经开始拉下帷幕了，未来究竟在哪，谁也给不出一个准确的答案。跟着行业走的技术也只能跟着行业的兴衰。作为技术，不能只着眼一处，保持学习，才能永远不被拉下。</p>
<h3 id="17年，路在哪里"><a href="#17年，路在哪里" class="headerlink" title="17年，路在哪里"></a>17年，路在哪里</h3><p>絮叨半天，发现自己的行文依旧这么烂（逃。年终总结，不就是应该给未来的自己避免踩上同一个坑吗。17年会怎么样，我不知道。但是我想我应该让自己知道17该怎么样。</p>
<p>读书依旧是不可少的，保持一个月一本的节奏。</p>
<p>技术上，本职上的iOS客户端开发要深挖下去，不能停留在表面的应用了。初次之外，学学数据处理分析相关的技术吧。</p>
<p>锻炼，16年的断断续续的，没能保持一定惯性。锻炼是最考验一个人意志力的行为。17年要保持，只有一个好身体才能应付一切。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">杂</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/31/2016-12-31-2016，注定不平凡/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 之行
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 50%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
        
      
      <li style="width: 50%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">心得</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">杂</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">iOS</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>